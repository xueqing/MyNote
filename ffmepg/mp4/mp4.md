# 了解 MP4

- [了解 MP4](#了解-mp4)
  - [概念](#概念)
  - [概述](#概述)
  - [历史](#历史)
  - [文件名扩展](#文件名扩展)
  - [数据流](#数据流)
  - [元数据](#元数据)
  - [参考](#参考)

## 概念

## 概述

**“MPEG-4 第 14 部分”** 或 **MP4** 是一种数字多媒体容器格式，最常用于存储视频和音频，但也可用于存储其他数据，比如字幕和静止图像。像大多数现代容器格式一样，它允许通过网络流式传输。规范定义的 “MPEG-4 第 14 部分”的唯一文件扩展名是 **.mp4**。指定“MPEG-4 第 14 部分”(正式为 **ISO/IEC 14496-14:2003**) 标准为 MPEG-4 的一部分。

便携式媒体播放器有时称作“MP4 播放器”，尽管有些只是 MP3 播放器，这些播放器也可以播放 AMV 视频或一些其他视频格式，但是不必播放“MPEG-4 第 14 部分”格式。

## 历史

“MPEG-4 第 14 部分”是更通用的 ISO/IEC 14496-12:2004(MPEG-4 第 12 部分：ISO 基本媒体文件格式)的一个实例，它直接基于 QuickTime 文件格式。“MPEG-4 第 14 部分”和 QuickTime 文件格式基本相同，但是正指定支持初始对象描述符(IOD)和其他 MPEG 功能。“MPEG-4 第 14 部分”修正并完全替代了 ISO/IEC 14496-1(MPEG-4 第 1 部分：系统)的第 13 条，该条预先指定了 MPEG-4 内容的文件格式。

MPEG-4 文件格式规范基于 2001 年发布的 QuickTime 格式。MPEG-4 文件格式第 1 版在 2001 年作为 ISO/IEC 14496-1:2001 发布，它修订了 1999 年发布的 “MPEG-4 第 1 部分：系统”(ISO/IEC 14496-1:1999)。“MPEG-4 第 14 部分：MP4 文件格式”(ISO/IEC 14496-14:2003)，通常称为 MPEG-4 文件格式版本 2，在 2003 年发布，它修正并替代了 MP4 文件格式的第 1 版。将 MP4 文件格式通用化为 ISO 基本媒体文件格式 ISO/IEC 14496-12:2004，该格式为基于时间的媒体文件定义了通用结构。并将其作为该家族其他文件格式的基础(比如 MP4、3GP、Motion JPEG 2000)。

MP4 文件格式版本

| 版本 | 发布日期 | 标准 | 描述 |
| --- | --- | --- | --- |
| MP4 文件格式第 1 版 | 2001 | ISO/IEC 14496-1:2001 | MPEG-4 第 1 部分(系统)，第 1 版 |
| MP4 文件格式第 2 版 | 2003 | ISO/IEC 14496-14:2003 | MPEG-4 第 14 部分(MP4 文件格式)，第 2 版 |

MP4 文件格式通过 ISO 基本媒体文件格式定义了一些扩展，以支持 MPEG-4 视音频编解码器和各种 MPEG-4 系统功能(比如对象描述符和场景描述)。其中一些扩展还被用于其他基于基本媒体文件格式的扩展(比如 3GP)。ISO 基本媒体文件格式已注册的所有扩展列表发布在官方注册机构网站。“MP4 家族”文件中代码点(标识符值)的注册机构是苹果公司，并在“MPEG-4 第 12 部分”的附件 D(信息性的)中命名。编解码器设计者应该注册他们发明的代码，但是此注册不是强制性的，并且某些发明和使用的代码点并未注册。如果基于 ISO 基本媒体文件格式创建新规范，应将全部现有规范作为其定义和技术的示例和来源。如果某个现有规范已经涵盖了如何以文件格式存储特定媒体类型(比如 MP4 中的 MPEG-4 音频或视频)，则应使用该定义，而不应发明新的定义。

## 文件名扩展

虽标准定义的唯一扩展名是 `.mp4`，但通常会使用不同扩展名来指示文件内容：

- 同时包含音频和视频的 MPEG-4 文件使用标准的 `.mp4` 扩展名
- 只包含音频的 MPEG-4 文件一般使用 `.m4a` 扩展名，尤其用于不受保护的内容
  - 包含加密音频流的 MPEG-4 文件使用 `.m4p` 扩展名，它是通过 iTunes Store 销售的 FairPlay 数字版权管理加密。iTunes Store 当前出售的 iTunes Plus 曲目未加密，因此使用 `.m4a`
  - 有声书和播客文件(也包含元数据，包含章标记、图像和超链接)可使用 `.m4a` 扩展名，但最常使用的是 `.m4b` 扩展名。`.m4a` 音频文件不能“收藏”(记住最后一个收听点)，而 `.m4b` 扩展文件可以。苹果公司的 iPhone 铃声使用 MPEG-4 音频，但扩展名是 `.m4r` 而不是 `.m4a`
- 原始的 MPEG-4 视频流使用 `.m4v`，但是该扩展名有时也用于 MP4 容器格式的视频
- 移动电话使用类似于 MP4 的 3GP 视频格式，它实现了“MPEG-4 第 12 部分”(即 MPEG-4/JPEG2000 ISO 基本媒体文件格式)。3GP 格式使用 `.3gp` 和 `.3g2` 扩展名。这些文件也存储非 MPEG-4 数据(H.263、AMR、TX3G)。实际上，大多数(如果不是全部)低端电话和功能电话都以这种格式录像，因为大多数(如果不是全部)其他移动电话和智能手机都使用 `.mp4` 文件扩展名录 MP4 文件，而且一些高端电话[哪个？]可录制成 `.raw`。

## 数据流

大多数种类的数据可以通过私有流嵌入到“MPEG-4 第 14 部分”文件。这种文件使用一个单独的信息轨道存储流信息。基于“MPEG-4 第 12 部分”文件注册的编解码器发布在 MP4 注册机构(mp4ra.org)网站上，但其中大多数并未得到 MP4 播放器的广泛支持。MP4 播放器广泛支持的编解码器和其他数据流是：

- 视频：“MPEG-H 第 2 部分”(H.265/HEVC)、“MPEG-4 第 10 部分”(H.264/AVC)和 “MPEG-4 第 2 部分”。其他压缩格式较少使用：MPEG-2 和 MPEG-1
- 音频：高级音频编码(AAC)。
  - 还有“MPEG-4 第 3 部分”的音频对象，比如音频无损编码(ALS)、可扩展无损编码(SLS)、MP3、“MPEG-1 音频层 II”(MP2)、“MPEG-1 音频层 I”(MP1)、CELP、HVXC(语音)、TwinVQ、文本到语音界面(TTSI)和结构化音频乐团语言(SAOL)
  - 其他压缩格式较少使用：苹果无损和免费无损音频编解码器(2018 年末增加)
- 字幕：MEPG-4 定时文本(也称为 3GPP 定时文本)
  - Nero Digital 在 MP4 文件中使用 DVD 视频字幕

所谓的 moov atom 包含的信息有关视频分辨率、帧率、方向、显示特性等信息。它可能放在文件开头或末尾。对于后者，如果文件格式不完整(被截断)，视频文件将无法播放。

## 元数据

MP4 文件可以包含格式标准定义的元数据，此外，还可以包含可扩展元数据平台(XMP)标准的元数据。

## 参考

- [MPEG-4 Part 14](https://en.wikipedia.org/wiki/MPEG-4_Part_14)
