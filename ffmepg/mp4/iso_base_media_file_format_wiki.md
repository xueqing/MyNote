# ISO 基本媒体文件格式

- [ISO 基本媒体文件格式](#iso-基本媒体文件格式)
  - [概述](#概述)
  - [历史](#历史)
  - [扩展](#扩展)
  - [技术细节](#技术细节)
    - [文件类型 box](#文件类型-box)
    - [流](#流)

翻译 [ISO/IEC base media file format](https://en.wikipedia.org/wiki/ISO/IEC_base_media_file_format)。

## 概述

**ISO/IEC 基本媒体文件格式**(ISO/IEC 14496-12: MPEG-4 第 12 部分)为基于时间的多媒体文件(比如视频和音频)定义了通用结构。相同的文本也发布到 ISO/IEC 15444-12(JPEG 2000, 第 12 部分)。

此文件格式被设计为一种灵活、可扩展的格式，以方便媒体的交换、管理、编辑和展示。媒体展示可以是本地的，或经由网络或其他流传递机制。它的设计独立于任何特定的网络协议，但总体支持这些网络协议。它被用作其他媒体文件格式(比如容器格式 MP4 和 3GP)的基础。

## 历史

ISO/IEC 基本媒体文件格式直接基于苹果的 QuickTime 容器格式。它是由 MPEG(ISO/IEC JTC1/SC29/WG11) 开发的。第一个 MP4 文件格式规范基于 2001 年发布的 QuickTime 格式规范创建。“第 1 版” MP4 文件格式在 2001 年作为 ISO/IEC 14496-1:2001 发布，修正了 “MPEG-4 第 14 部分: 系统”。“MPEG-4 第 14 部分: MP4 文件格式”(ISO/IEC 14496-14:2003)，通常称为 MPEG-4 文件格式“第 2 版”，在 2003 年发布，它修正并替代了第 1 版。将 MP4 文件格式通用化为 ISO/IEC 基本媒体文件格式(ISO/IEC 14496-12:2004 或 ISO/IEC 15444-12:2004)，它为基于时间的媒体文件定义了通用结构。并将其作为该家族其他文件格式的基础(比如 MP4、3GP、Motion JPEG 2000)。

MPEG-4 第 12 部分/JPEG 2000 第 12 部分版本

| 版本 | 发布日期 | 最新修订 | 标准 | 描述 |
| --- | --- | --- | --- | --- |
| 第 1 版 | 2004 | - | ISO/IEC 14496-12:2004, ISO/IEC 15444-12:2004 | - |
| 第 2 版 | 2005 | 2008 | ISO/IEC 14496-12:2005, ISO/IEC 15444-12:2005 | - |
| 第 3 版 | 2008 | 2009 | ISO/IEC 14496-12:2008, ISO/IEC 15444-12:2008 | - |
| 第 4 版 | 2012 | - | ISO/IEC 14496-12:2012, ISO/IEC 15444-12:2012 | - |
| 第 5 版 | 2015 | - | ISO/IEC 14496-12:2015, ISO/IEC 15444-12:2015 | - |

2017 年 1月，撤回了 ISO/IEC 15444-12，改为采用  ISO/IEC 14496-12:2015。

## 扩展

ISO/IEC 基本媒体文件格式被设计为可扩展文件格式。ISO/IEC 基本媒体文件格式已注册的所有扩展列表发布在官方注册机构网站 www.mp4ra.org。“MP4 家族”文件中代码点(标识符值)的注册机构是苹果公司，并在“MPEG-4 第 12 部分”的附件 D(信息性的)中命名。编解码器设计者应该注册他们发明的代码，但是此注册不是强制性的，并且某些发明和使用的代码点并未注册。如果基于 ISO 基本媒体文件格式创建新规范，应将全部现有规范作为其定义和技术的示例和来源。如果某个现有规范已经涵盖了如何以文件格式存储特定媒体类型(比如 MP4 中的 MPEG-4 音频或视频)，则应使用该定义，而不应发明新的定义。

MPEG 已标准化了许多规范，它们扩展了 ISO/IEC 基本媒体文件格式：MP4 文件格式(ISO/IEC 14496-14)定义了一些对 ISO/IEC 基本媒体文件格式的扩展，以支持 MPEG-4 视音频编解码器和各种 MPEG-4 系统功能，例如对象描述符和场景描述。 MPEG-4 第 3 部分(MPEG-4 音频)标准还定义了一些音频压缩格式的存储。ISO/IEC 14496-3:2001/Amd 3:2005 中定义了以 ISO/IEC 基本媒体文件格式存储 MPEG-1/2 音频(MP3，MP2，MP1)。高级视频编码(AVC)文件格式(ISO/IEC 14496-15)定义了对 H.264/MPEG-4 AVC 视频压缩的支持。高效图像文件格式(HEIF)是一种以 ISO/IEC 基本媒体文件格式为基础的图像容器格式。尽管 HEIF 可与任何图像压缩格式一起使用，但它特别包含了对 HEVC 帧内编码图像和 HEVC 编码图像序列的支持，并利用了图片间预测。

其他基于 ISO/IEC 基本媒体文件格式(例如 3GP)的格式也使用上述某些 MPEG 标准扩展名。3GPP 文件格式(.3gp)规范还定义了扩展名，以支持文件中的 H.263 视频、AMR-NB、AMR-WB、AMR-WB+ 音频和 3GPP 定时文本，这些文件基于 ISO/IEC 基本媒体文件格式。3GPP2 文件格式(.3g2)定义扩展名以使用 EVRC、SMV 或 13K(QCELP) 语音压缩格式。JPEG 2000 规范(ISO/IEC 15444-3)在 ISO/IEC 基本媒体文件格式(.mj2)中定义了 Motion JPEG 2000 视频压缩和未压缩音频(PCM)的用法。DVB Project 定义的“DVB 文件格式”(.dvb)允许以 ISO/IEC 基本媒体文件格式存储 DVB 服务。它允许以三种主要方式中的任何一种来存储音频、视频和其他内容：封装在 MPEG 传输流中，存储为接收 hint 轨道；封装在 RTP 流中，存储为接收 hint 轨道或直接存储为媒体轨道。MPEG-21 文件格式(.m21，.mp21)定义了在同一文件以 ISO/IEC 基本媒体文件格式存储的 MPEG-21 数字项及其部分或全部辅助数据(例如电影、图像或其他非 XML 数据)。来自开放移动联盟的 OMA DRM 内容格式(.dcf)规范定义了受 DRM 保护的加密媒体对象和相关元数据的内容格式。还有其他扩展，例如用于加密/受保护的音频和视频的 ISMA ISMACryp 规范、G.719 音频压缩规范、AC3 和 E-AC-3 音频压缩、DTS 音频压缩、Dirac 视频压缩、VC-1 视频压缩规范等，在 MP4 注册机构的网站上指定。

## 技术细节

ISO/IEC 基本媒体文件格式为定时的媒体数据序列(比如音视频演示)存储时间、结构和媒体信息。文件结构是面向对象的。可以非常简单地将文件分解为基本对象，基本对象的类型隐含对象的结构。

符合 ISO/IEC 基本媒体文件格式的文件被组织成一系列对象，称为 “box”。所有数据都保存在 box 中，且文件内部没有其他数据。这包括特定文件格式所需的任何初始签名。box 是面向对象的构建块，由一个唯一的类型标识符和长度定义。在一些规范中也称为 “atom”(比如 MP4 文件格式的第一个定义)。

演示(运动序列)可能包含在多个文件中。所有时间和帧(位置和大小)信息必须在 ISO 基本媒体文件中，且附属文件实际上可使用任何格式。附属文件必须只能由 ISO/IEC 基本媒体文件格式中定义的元数据描述。

### 文件类型 box

为了识别基于 ISO/IEC 基本媒体文件格式的文件所遵循的规范，在文件格式中使用 brand 作为标识符。在，名为文件类型 box(“ftye”)的 box 中设置 brand，且此 box 必须放在文件开头。它有点类似所谓的 fource 代码，嵌入 AVI 容器格式的媒体出于类似目的会使用 fource 代码。brand 可能会指示使用的编码类型、每种编码数据的存储方式、文件适用的限制和扩展名、兼容性，或文件的预期用途。brand 是可打印的四字符的代码。文件类型 box 包含两种 brand。一种是 “major_brand”，它表示了文件最佳使用的规范。其后跟随的是 “minor_version”，是 4 字节的信息整数，用于主 brand 的次要版本。第二种 brand 是 “compatible_brands”，它标识文件遵循的多个规范。所有文件应该包含一个文件类型 box，但是为了和规范的早期版本兼容，文件可能符合 ISO/IEC 基本媒体文件格式，但是并未包含文件类型 box。在这种情况下，应将其视为包含了一个 ftyp，其中有主要和兼容性 brand “mp41”(MP4 v1 – ISO 14496-1, 第 13 章)。许多在用的 brand (ftyp) 并未注册，且可以在某些网页上找到。

基于 ISO/IEC 基本媒体文件格式构造的多媒体文件可能兼容多个具体规范，因此并非总是谈论该文件的单个 “type” 或 “brand”。在这方面。多用途 Internet 邮件扩展名类型和文件扩展名的作用有所减少。尽管如此，当编写派生规范时，将使用新的文件扩展名、新的 MIME 类型和新的 Macintosh 文件类型。

### 流

ISO/IEC 基本媒体文件格式 支持通过网络的媒体数据流和本地回放。支持流传输的文件包含有关流传输的数据单元的信息(如何通过流传输协议为文件中的基本流数据提供服务)。该信息放在文件额外的轨道，称为 “hint” 轨道。同一文件中可能为不同协议保存单独的 “hint” 轨道。媒体将通过所有此类协议播放，而无需添加媒体数据的其他副本或版本。通过增加适当的 hint 轨道，可轻松地将现有媒体用于其他特定协议的流传输。媒体信息本身不需要任何重新格式化。服务器在 hint 轨道指示下发送的流不需要包含具体文件的跟踪信息。当本地回放演示时(不是流传输)，hint 轨道可以忽略。可使用创作工具创建 hint 轨道，或者使用提示工具将其添加到现有文件(演示)。为渐进式下载创作的媒体中，包含帧索引的 moov box 应放在电影数据 mdat box 之前。
