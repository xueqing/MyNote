# 基本流 ES

- [基本流 ES](#基本流-es)
  - [缩略词](#缩略词)
  - [概述](#概述)
  - [MPEG-2 视频 ES 的头](#mpeg-2-视频-es-的头)
  - [MPEG-1 音频 ES 的通用格式](#mpeg-1-音频-es-的通用格式)
  - [参考](#参考)

原文 [Elementary stream](https://en.wikipedia.org/wiki/Elementary_stream)

## 缩略词

```text
ES
  elementary stream, 基本流。
PES
  packetized elementary stream, 分组化基本流。PES 承载 ES，或非 MPEG 的编码流。
VBV
  video buffering verifier, 视频缓存检验器。
intra quantizer matrix
  帧内量化矩阵。
CRC
  cyclic redundancy check, 循环冗余校验。
```

## 概述

MPEG 通信协议定义 ES 通常是一个音频或视频编码器的输出。ES 只包含一种数据(比如音频、视频或闭路字幕)。一个 ES 通常称作 “基本”、“数据”、“音频”或“视频”字节流或流。ES 的格式取决于编解码器或流承载的数据，但是当被分包成 PES 时经常会承载一个公共头。

## MPEG-2 视频 ES 的头

部分序列头格式

| 域 | 比特数 | 描述 |
| --- | --- | --- |
| 起始码 | 32 | 0x000001B3 |
| 水平大小 | 12 | - |
| 垂直大小 | 12 | - |
| 纵横比 | 4 | - |
| 帧率码 | 4 | - |
| 比特率 | 18 | `实际比特率 = 比特率*400`，向上取整。可变比特率使用 0x3FFFF |
| 标记位 | 1 | 总是 1 |
| VBV 缓存大小 | 10 | `视频缓存检验器大小 = 16*1024*vbv 缓冲大小` |
| 约束参数标志 | 1 | - |
| 加载帧内量化矩阵 | 1 | 如果设置为 1，那么紧跟的是帧内量化矩阵，否则使用默认值 |
| 帧内量化矩阵 | 0 或 64*8 | - |
| 加载非帧内量化矩阵 | 1 | 如果设置为 1，那么紧跟的是非帧内量化矩阵，否则使用默认值 |
| 非帧内量化矩阵 | 0 或 64*8 | - |

## MPEG-1 音频 ES 的通用格式

数字化的声音信号在层 I 被分割成 384 采样的块，在层 II 和层 III 分成 1152 采样的块。声音采样块被编码进一个音频帧：

- 头
- 错误检查
- 音频数据
- 辅助数据

一个帧的头包含通用信息，比如 MPEG 层、采样频率、声道数目、帧是否是 CRC 保护的、声音是否是原始的：

| 域 | 比特数 | 描述 |
| --- | --- | --- |
| 同步字 | 12 | 0xFFF |
| ID | 1 | '1'-mpeg; '0'-mpeg2 |
| 层 | 2 | '11'-1; '10'-2; '01'-3 |
| 未保护的 | 1 | '0'-被 CRC 保护(头后紧跟 16 比特的 CRC); '1'-未保护 |
| 比特率索引 | 4 | - |
| 采样频率 | 2 | 单位 kHz。'00'-44.1; '01'-48; '10'-32 |
| 填充 | 1 | - |
| 私有的 | 1 | - |
| 模式 | 2 | '00'-立体声(Stereo); '01'-联合立体声(joint stereo); '10'-双声道(dual channel); '11'-单声道(single channel) |
| 模式扩展 | 2 | - |
| 受版权保护的 | 1 | 0-不保护；1-保护的 |
| 原始的或拷贝的 | 1 | 0-拷贝；1-原始的 |
| 强调 | 2 | - |

虽然大多数信息可能对于所有帧相同，MPEG 决定给每个音频帧一个这样的头，以便简化同步和比特流编辑。

## 参考

- [Elementary stream](https://en.wikipedia.org/wiki/Elementary_stream)
