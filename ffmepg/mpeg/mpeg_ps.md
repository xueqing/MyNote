# MPEG PS

- [MPEG PS](#mpeg-ps)
  - [缩略词](#%e7%bc%a9%e7%95%a5%e8%af%8d)
  - [概述](#%e6%a6%82%e8%bf%b0)
  - [编码结构](#%e7%bc%96%e7%a0%81%e7%bb%93%e6%9e%84)
  - [编码细节](#%e7%bc%96%e7%a0%81%e7%bb%86%e8%8a%82)
  - [参考](#%e5%8f%82%e8%80%83)

原文 [MPEG program stream](https://en.wikipedia.org/wiki/MPEG_program_stream)

## 缩略词

```text
PES
  packetized elementary stream, 分组化基本流。PES 承载 ES，或 非 MPEG 的编码流。
PCR
  program clock reference, 节目时钟参考。
SCR
  system clock reference, PS 中的时间戳。相对的，PCR 出现在 TS 中。在大多常见情形，SCR 值和 PCR 值作用相同；然而，最大支持的 SCR 间隔是 700 ms，PCR 最大间隔是 100 ms。
```

## 概述

节目流(program stream, PS/MPEG-PS)是一个用于多路复用数字音频、视频等的文件格式。PS 格式在 MPEG-1 Part 1 (ISO/IEC 11172-1) and MPEG-2 Part 1, Systems (ISO/IEC standard 13818-1/ITU-T H.222.0) 中定义。MPEG-2 PS 和 ISO/IEC 11172 系统层类似，且向前兼容。

PS 用于 DVD-视频磁盘和 HD DVD 视频磁盘，但是包括一些约束和扩展。文件扩展名分别是 VOB 和 EVO。

## 编码结构

通过组合一个或多个 PES (有一个公共时间基准)到一个流，创建一个 PS。相对 MPEG TS 用于可能丢失数据的数据传输，PS 被设计用于相对可靠的媒介，比如磁盘。PS 有可变大小的记录和极少的使用起始码，使得通过空气传输困难，但是负载更少。PS 编码层只支持一个或多个的 ES 的一个节目，节目被分包到一个流中，而 TS 支持多个节目。

MPEG-2 PS 可以包含 MPEG-1 Part 2 视频、MPEG-2 Part 2 视频、MPEG-1 Part 3 音频(MP3/MP2/MP1)或 MPEG-2 Part 3 音频。它也可以包含 MPEG-4 Part 2 视频、MPEG-2 Part 7 音频(AAC) 或 MPEG-4 Part 3(AAC) 音频，但是它们很少被使用。MPEG-2 PS 规定了非标准数据(比如 AC-3 音频或字母)私有流的形式。国际标准化组织授权 SMPTE 注册机构，LLC 作为 MPEG-2 格式标识符的注册机构。它发布了压缩格式的列表，这些格式可被封装进 MPEG-2 TS 和 PS。

## 编码细节

部分 MPEG-2 PS pack 头格式

| 名称 | 比特数 | 描述 |
| --- | --- | --- |
| 同步字节 | 32 | 0x000001BA |
| 标记位 | 2 | MPEG-2 版本是 '01'。MPEG-1 版本的标记位是 4 比特的值 '0010' |
| 系统时钟[32..30] | 3 | SCR 的 32 到 30 比特 |
| 标记位 | 1 | 总是设置为 1 |
| 系统时钟[29..15] | 15 | SCR 的 29 到 15 比特 |
| 标记位 | 1 | 总是设置为 1 |
| 系统时钟[14..0] | 15 | SCR 的 14 到 0 比特 |
| 标记位 | 1 | 总是设置为 1 |
| SCR 扩展 | 9 | - |
| 标记位 | 1 | 总是设置为 1 |
| 比特率 | 22 | 单位是每秒 50 字节 |
| 标记位 | 2 | 总是设置为 11 |
| 预留 | 5 | 预留将来使用 |
| 填充长度 | 3 | - |
| 填充字节 | 8*填充长度 | - |
| 系统头(可选) | 0 或更多 | 如果有系统头，紧跟的起始码是 0x000001BB |

部分系统头格式(18 字节)

| 名称 | 比特数 | 描述 |
| --- | --- | --- |
| 同步字节 | 32 | 0x000001BB |
| - | - | 4 字节 |
| 头长度 | 16 | - |
| - | - | 2 字节 |
| 标记位 | 1 | 总是设置为 1 |
| 速率限制 | 22 | - |
| 标记位 | 1 | 总是设置为 1 |
| - | - | 上述 24 比特(3 字节)是速率限制和标记位 |
| 音频限制 | 6 | - |
| 固定标志 | 1 | - |
| CSPS 标志 | 1 |
| - | - | 上述 8 比特(1 字节)是音频限制和标志 |
| 系统音频锁定标志 | 1 | - |
| 系统视频锁定标志 | 1 | - |
| 标记位 | 1 | 总是设置为 1 |
| 视频限制 | 5 | - |
| - | - | 上述 8 比特(1 字节)是标志、标记位和视频限制 |
| 分组速率限制标志 | 1 | - |
| 预留 | 7 | - |
| - | - | 上述 8 比特(1 字节)是包速率限制和预留字节 |
| - | - | 如果下一个比特是 '1'，表示后面是流信息(包含 4 个熟悉)。可循环判断 |
| 流 id | 8 | 视频(如 e0) |
| 标记位 | 2 | 总是设置为 11 |
| P-STD 缓冲区限制比例 | 1 | - |
| P-STD 缓冲区大小限制 | 13 | - |
| - | - | 上述 24 比特(3 字节)是视频流信息 |
| 流 id | 8 | 音频(如 c0) |
| 标记位 | 2 | 总是设置为 11 |
| P-STD 缓冲区限制比例 | 1 | - |
| P-STD 缓冲区大小限制 | 13 | - |
| - | - | 上述 24 比特(3 字节)是音频流信息 |

PS map (PSM, 节目流映射)头格式(30 字节)

| 名称 | 比特数 | 描述 |
| --- | --- | --- |
| 包起始码前缀 | 24 | 0x000001 |
| 映射流标识 | 8 | 0XBC |
| 节目流映射长度 | 16 | - |
| 当前的下一个指示符字段 | 1 | - |
| 填充字段 | 2 | - |
| PSM 版本字段 | 5 | - |
| 预留 | 7 | - |
| 标记位 | 1 | - |
| 节目流信息长度 | 16 | 之后的描述符总长度(字节数) |
| 基本流映射长度 | 16 | 之后定义流的总长度 |
| 流类型 | 8 | - |
| 基本流 id | 8 | - |
| 基本流信息长度 | 16 | 后面描述基本流的信息长度 |
| - | - | 上述 32 比特(4 字节可能会重复) |
| CRC_32 | 32 | - |

## 参考

- [MPEG program stream](https://en.wikipedia.org/wiki/MPEG_program_stream)
- [SCR](http://www.bretl.com/mpeghtml/SCR.HTM)
