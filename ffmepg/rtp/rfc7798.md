# 高效视频编码(HEVC)的 RTP 载荷格式

- [高效视频编码(HEVC)的 RTP 载荷格式](#高效视频编码hevc的-rtp-载荷格式)
  - [摘要](#摘要)
  - [1 介绍](#1-介绍)
    - [1.1 HEVC 编解码器概述](#11-hevc-编解码器概述)
      - [1.1.1 编码工具功能](#111-编码工具功能)
        - [四叉树块与变换结构](#四叉树块与变换结构)
        - [熵编码](#熵编码)
        - [环路内滤波](#环路内滤波)
        - [运动预测与编码](#运动预测与编码)
        - [帧内预测和帧内编码](#帧内预测和帧内编码)
        - [其他编码工具功能](#其他编码工具功能)
      - [1.1.2 系统和传输接口](#112-系统和传输接口)
        - [视频参数集](#视频参数集)
        - [配置、层和级别](#配置层和级别)
        - [比特流和基本流](#比特流和基本流)
        - [随机访问支持](#随机访问支持)
        - [时间可伸缩性支持](#时间可伸缩性支持)
        - [时间子层交换支持](#时间子层交换支持)
        - [子层参考或非参考图像](#子层参考或非参考图像)
        - [扩展性](#扩展性)
        - [比特流提取](#比特流提取)
        - [参考图像管理](#参考图像管理)
        - [超低延迟支持](#超低延迟支持)
        - [新 SEI 消息](#新-sei-消息)
      - [1.1.3 并行处理支持](#113-并行处理支持)
      - [1.1.4 NAL 单元头](#114-nal-单元头)
    - [1.2 载荷格式概述](#12-载荷格式概述)
  - [2 惯例](#2-惯例)
  - [3 定义和缩写](#3-定义和缩写)
    - [3.1 定义](#31-定义)
      - [3.1.1 HEVC 规范中的定义](#311-hevc-规范中的定义)
        - [访问单元](#访问单元)
        - [BLA 访问单元](#bla-访问单元)
        - [BLA 图像](#bla-图像)
        - [编码视频序列(CVS)](#编码视频序列cvs)
        - [CRA 访问单元](#cra-访问单元)
        - [CRA 图像](#cra-图像)
        - [IDR 访问单元](#idr-访问单元)
        - [IDR 图像](#idr-图像)
        - [IRAP 访问单元](#irap-访问单元)
        - [IRAP 图像](#irap-图像)
        - [层](#层)
        - [操作点](#操作点)
        - [随机访问](#随机访问)
        - [子层](#子层)
        - [子层表示](#子层表示)
        - [平铺](#平铺)
        - [平铺列](#平铺列)
        - [平铺行](#平铺行)
      - [3.1.2 本文的特定定义](#312-本文的特定定义)
        - [被依赖 RTP 流](#被依赖-rtp-流)
        - [最高 RTP 流](#最高-rtp-流)
        - [媒体感知网络元素(MANE)](#媒体感知网络元素mane)
        - [媒体传输](#媒体传输)
        - [单媒体传输多 RTP 流(MRST)](#单媒体传输多-rtp-流mrst)
        - [多媒体传输多 RTP 流(MRMT)](#多媒体传输多-rtp-流mrmt)
        - [NAL 单元解码顺序](#nal-单元解码顺序)
        - [NAL 单元输出顺序](#nal-单元输出顺序)
        - [类 NAL 单元结构](#类-nal-单元结构)
        - [NALU 时间](#nalu-时间)
        - [RTP 流](#rtp-流)
        - [单媒体传输单 RTP 流(SRST)](#单媒体传输单-rtp-流srst)
        - [传输顺序](#传输顺序)
    - [3.2 缩写](#32-缩写)
  - [4 RTP 载荷格式](#4-rtp-载荷格式)
    - [4.1 RTP 头部用法](#41-rtp-头部用法)
    - [4.2 载荷头部用法](#42-载荷头部用法)
    - [4.3 传输模式](#43-传输模式)
    - [4.4 载荷结构](#44-载荷结构)
      - [4.4.1 单 NAL 单元数据包](#441-单-nal-单元数据包)
      - [4.4.2 聚合包(AP)](#442-聚合包ap)
      - [4.4.3 分片单元](#443-分片单元)
      - [4.4.4 PACI 包](#444-paci-包)
        - [4.4.4.1 PACI 规则的原因(资料性)](#4441-paci-规则的原因资料性)
        - [4.4.4.2 PACI 扩展(资料性)](#4442-paci-扩展资料性)
    - [4.5 时间可扩展性控制信息](#45-时间可扩展性控制信息)
    - [4.6 解码顺序号](#46-解码顺序号)
  - [5 打包规则](#5-打包规则)
  - [6 解包过程](#6-解包过程)
  - [7 载荷格式参数](#7-载荷格式参数)
    - [7.1 媒体类型注册](#71-媒体类型注册)
      - [**可选**参数](#可选参数)
        - [profile-space, tier-flag, profile-id, profile-compatibility-indicator, interop-constraints 和 level-id](#profile-space-tier-flag-profile-id-profile-compatibility-indicator-interop-constraints-和-level-id)
          - [profile-space, profile-id](#profile-space-profile-id)
          - [tier-flag, level-id](#tier-flag-level-id)
          - [interop-constraints](#interop-constraints)
          - [profile-compatibility-indicator](#profile-compatibility-indicator)
        - [sprop-sub-layer-id](#sprop-sub-layer-id)
        - [recv-sub-layer-id](#recv-sub-layer-id)
        - [max-recv-level-id](#max-recv-level-id)
        - [tx-mode](#tx-mode)
        - [sprop-vps](#sprop-vps)
        - [sprop-sps](#sprop-sps)
        - [sprop-pps](#sprop-pps)
        - [sprop-sei](#sprop-sei)
        - [max-lsr, max-lps, max-cpb, max-dpb, max-br, max-tr, max-tc](#max-lsr-max-lps-max-cpb-max-dpb-max-br-max-tr-max-tc)
          - [max-lsr](#max-lsr)
          - [max-lps](#max-lps)
          - [max-cpb](#max-cpb)
          - [max-dpb](#max-dpb)
          - [max-br](#max-br)
          - [max-tr](#max-tr)
          - [max-tc](#max-tc)
        - [max-fps](#max-fps)
        - [sprop-max-don-diff](#sprop-max-don-diff)
        - [sprop-depack-buf-nalus](#sprop-depack-buf-nalus)
        - [sprop-depack-buf-bytes](#sprop-depack-buf-bytes)
        - [depack-buf-cap](#depack-buf-cap)
        - [sprop-segmentation-id](#sprop-segmentation-id)
        - [sprop-spatial-segmentation-idc](#sprop-spatial-segmentation-idc)
        - [dec-parallel-cap](#dec-parallel-cap)
        - [include-dph](#include-dph)
      - [编码注意事项](#编码注意事项)
      - [安全考虑](#安全考虑)
      - [已发布的规范](#已发布的规范)
      - [其他信息](#其他信息)
      - [文件扩展名](#文件扩展名)
      - [Macintosh 文件类型代码](#macintosh-文件类型代码)
      - [对象标识符或 OID](#对象标识符或-oid)
      - [联系人和电子邮件地址，以获取更多信息](#联系人和电子邮件地址以获取更多信息)
      - [预期用途](#预期用途)
      - [作者](#作者)
      - [更改控制器](#更改控制器)
    - [7.2 SDP 参数](#72-sdp-参数)
      - [7.2.1 载荷类型参数到 SDP 的映射](#721-载荷类型参数到-sdp-的映射)
      - [7.2.2 与 SDP Offer/Answer 模型一起使用](#722-与-sdp-offeranswer-模型一起使用)
      - [7.2.3 声明性会话描述中使用](#723-声明性会话描述中使用)
      - [7.2.4 参数集考虑](#724-参数集考虑)
      - [7.2.5 多流模式下的依赖标识](#725-多流模式下的依赖标识)
  - [8 与反馈消息一起使用](#8-与反馈消息一起使用)
    - [8.1 图像丢失指示(PLI)](#81-图像丢失指示pli)
    - [8.2 切片丢失指示(SLI)](#82-切片丢失指示sli)
    - [8.3 参考图像选择指示(RPSI)](#83-参考图像选择指示rpsi)
    - [8.4 完整帧内请求(FIR)](#84-完整帧内请求fir)
  - [9 安全考虑](#9-安全考虑)
  - [10 拥塞控制](#10-拥塞控制)
  - [11 IANA 考虑](#11-iana-考虑)
  - [12 参考](#12-参考)
    - [12.1 规范性引用](#121-规范性引用)
    - [12.2 资料性引用](#122-资料性引用)
  - [致谢](#致谢)
  - [作者地址](#作者地址)

## 摘要

本文为视频编码标准 ITU-T H.265 建议和 ISO/IEC 23008-2 国际标准描述了 RTP 载荷格式，两者也称为高效视频编码(HEVC)，由视频编码联合协作小组开发(JCT-VC)。RTP 载荷格式支持在每个 RTP 载荷中打包一个或多个网络抽象层(NAL)单元，以及将一个 NAL 单元分片为多个 RTP 数据包。此外，它支持通过单个流以及多个 RTP 流传输 HEVC 比特流。当使用多个 RTP 流时，可以使用单个传输或多个传输。载荷格式在视频会议、互联网视频流和高比特率娱乐质量视频等方面具有广泛的适用性。

## 1 介绍

2013 年 4 月，ITU-T 批准了作为 ITU-T H.265 建议 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 和 ISO/IEC 23008-2 国际标准 [ISO23008-2](https://www.rfc-editor.org/rfc/rfc7798#ref-ISO23008-2) 正式发布的高效视频编码规范；据报道，它比 H.264 [H.264](https://www.rfc-editor.org/rfc/rfc7798#ref-H.264) 提供了显著的编码效率增益。

本文描述了 HEVC 的 RTP 载荷格式。它与 [RFC6184](https://www.rfc-editor.org/rfc/rfc6184) 和 [RFC6190](https://www.rfc-editor.org/rfc/rfc6190) 的 RTP 载荷格式共享其基本设计。在设计理念、安全性、拥塞控制和总体实现复分片单元杂性方面，它与早期载荷格式规范具有类似的特性。这是一个有意的选择，因为至少 RFC6184 被广泛部署，并且在相关的实现者社区中广为人知。HEVC 版本 1 合并 RFC6190 中的机制，支持时间可伸缩性。

为了帮助重叠的实现者社区，通常本文的非规范性解释部分只会突出显示 RFC 6184 和 6190 与 HEVC 载荷格式之间的差异。假设这些部分基本熟悉两种规范。但是，本文的规范性部分不要求研究 RFC 6184 或 6190。

### 1.1 HEVC 编解码器概述

H.264 和 HEVC 共享类似的混合视频编解码器设计。在本文中，我们简要概述 HEVC 的这些功能，本文指定的载荷格式以某种形式对它们进行了说明。实现者必须阅读、理解并应用与 HEVC 相关的 ITU-T/ISO/IEC 规范，以达到可互操作、性能良好的实现。实现者应该考虑使用 ITU-T/ISO/IEC 提供的工具测试其设计(包括载荷格式实现和核心视频编解码器之间的互通)，例如，在 [H.265.1](https://www.rfc-editor.org/rfc/rfc7798#ref-H.265.1) 中指定的一致性比特流。历史上，不这样做会导致系统性能差且不安全。

从概念上讲，H.264 和 HEVC 都包括视频编码层(VCL)和网络抽象层(NAL)，视频编码层(VCL)通常用于指代编码工具功能，网络抽象层(NAL)通常用于指代编解码器的系统和传输接口方面。

#### 1.1.1 编码工具功能

与早期基于混合视频编码的标准(包括 H.264)类似，HEVC 采用以下基本视频编码设计。首先通过帧内或运动补偿预测形成预测信号，然后对残差(原始和预测之间的差异)进行编码。与早期设计相比，通过重新设计和改进编解码器的几乎所有部分，以提高编码效率。此外，HEVC 还包括一些工具，使其在并行架构上的实现更容易。下面是 HEVC 编码工具功能的摘要。

##### 四叉树块与变换结构

对 HEVC 的编码效率做出重大贡献的主要工具之一是使用灵活的编码块和变换，它们以分层四叉树的方式定义。与 H.264 不同，H.264 的基本编码块是固定大小 16x16 的宏块，HEVC 定义了最大大小为 64x64 的编码树单元(Coding Tree Unit, CTU)。每个 CTU 可以以分层四叉树的方式划分为更小的单元，并且可以表示更小的大小为 4x4 的块。类似地，HEVC 中使用的变换可以有不同的大小，从 4x4 到 32x32。利用大的块和变换有助于 HEVC 的主要增益，特别是高分辨率。

##### 熵编码

HEVC 使用单个熵编码引擎，该引擎基于上下文自适应二进制算术编码(Context Adaptive Binary Arithmetic Coding, CABAC) [CABAC](https://www.rfc-editor.org/rfc/rfc7798#ref-CABAC)，而 H.264 使用两个不同的熵编码引擎。HEVC 中的 CABAC 与 H.264 中的 CABAC 有许多相似之处，但有一些改进。包括提高编码效率和降低实现复杂性，特别是并行架构。

##### 环路内滤波

H.264 包括一个环路内自适应去块滤波器，它平滑重建图像中变换边缘周围的块效应，以提高图像质量和压缩效率。在 HEVC 中，采用了类似的解块滤波器，但复杂度稍低。此外，图像还要经过一个称为采样自适应偏移(Sample Adaptive Offset, SAO)的后续滤波操作，这是 HEVC 中的一个新设计元素。SA- 基本上以自适应方式添加像素级偏移，通常用作去振铃滤波器。据观察，SA- 改善了尤其是锐利边缘周围的图像质量，大大改善了 HEVC 的视觉质量。

##### 运动预测与编码

这方面有许多改进，总结如下。第一类是运动合并和高级运动矢量预测(Advanced Motion Vector Prediction, AMVP)模式。可以从空间或时间上相邻的块推断预测块的运动信息。这类似于 H.264 中的 DIRECT 模式，但包含了新的方面与灵活的四叉树结构结合，以及改进并行实现的方法。此外，可以向运动矢量预测器发送信号以提高效率。第二类是高精度插值。插值滤波器长度从 6-tap 增加到 8-tap，这提高了编码效率，但也增加了复杂性。此外，插值滤波器的定义精度更高，无需任何中间舍入操作，以进一步提高编码效率。

##### 帧内预测和帧内编码

与 H.264 中的 8 帧内预测模式相比，HEVC 支持 33 个方向的角度帧内预测。这种增加的灵活性提高了目标编码效率和视觉质量，因为可以更好地预测边缘，并且可以减少边缘周围的振铃伪影。此外，根据预测方向自适应平滑参考采样。为了避免轮廓伪影。HEVC 包括一个新的插值预测生成，以提高视觉质量。此外，对于 4x4 帧内变换块，使用离散正弦变换(Discrete Sine Transform, DST)代替传统的离散余弦变换(Discrete Cosine Transform, DCT)。

##### 其他编码工具功能

HEVC 包括一些工具用于无损编码和高效屏幕内容编码，例如跳过某些块的转换。例如，当将移动设备的用户界面流式传输到大型显示器时，这些工具特别有用。

#### 1.1.2 系统和传输接口

HEVC 继承了 H.264 的基本系统和传输接口设计。其中包括基于 NAL 单元的语法结构、分层语法和数据单元结构、补充增强信息(SEI)消息机制以及基于假设参考解码器(Hypothetical Reference Decoder, HRD)的视频缓冲模型。分层语法和数据单元结构由序列级参数集、多图像级或图像级参数集、切片级头部参数和较低级别参数组成。下文列表总结了这些方面与 H.264 的差异。

##### 视频参数集

本文介绍了一种新的参数集，称为视频参数集(VPS)。对于[HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC)的第一个(2013)版本，VPS NAL 单元需要在激活之前可用，而解码过程的操作不需要 VPS 包含的信息。对于未来的 HEVC 扩展，例如 3D 或可伸缩扩展，VPS 预期包括解码过程的操作所必需的信息，例如解码依赖性或用于增强层的参考图像集构造的信息。VPS 提供了比特流的“大图”，包括提供了什么类型的操作点、操作点的配置、层和级别，以及可作为会话协商和内容选择基础的比特流的一些其他高级属性等(参见[第 7.1 节](#71-媒体类型注册))。

##### 配置、层和级别

配置、层和层语法结构可以包含在 VPS 和序列参数集(SPS)，包括 12 字节的数据来描述整个比特流(包括所有时间可伸缩层，在 HEVC 规范中称为子层)，并且可以可选地包括更多的配置、层以及与单个时间可伸缩层相关的级别信息。当比特流符合多个配置时，配置指示符显示“最佳查看方式”配置，类似于 ISO 基本媒体文件格式 (ISOBMFF) [IS014496-12](https://www.rfc-editor.org/rfc/rfc7798#ref-IS014496-12) [IS015444-12](https://www.rfc-editor.org/rfc/rfc7798#ref-IS015444-12) 中的 major brand 概念以及基于 ISOBMFF 派生的文件格式，例如 3GPP 文件格式 [3GPPFF](https://www.rfc-editor.org/rfc/rfc7798#ref-3GPPFF)。配置、层和层语法结构还包指示符，例如

1) 比特流是否没有帧压缩内容
2) 比特流是否没有隔行扫描的源内容
3) 比特流是否没有场图像

当 2) 和 3) 的答案均为是，比特流仅包含渐进源的帧图像。基于这些指示符，如果客户端/播放器不支持用于处理帧压缩、隔行扫描源内容或场图像的后期处理功能，可以拒绝包含这些图像的比特流。

##### 比特流和基本流

HEVC 定义了基本流，与 H.264 相比是新定义。基本流由一个或多个比特流的序列组成。由两个或多个比特流组成的基本流通常通过将两个或多个比特流(或其部分)拼接在一起形成。当基本流包含多个比特流时，比特流最后一个访问单元的最后一个 NAL 单元(基本流中的最后一个比特流除外)必须包含比特流结束 NAL 单元，并且后续比特流的第一个访问单元必须是帧内随机访问点(Intra-Random Access Point, IRAP)访问单元。该 IRAP 访问单元可以是干净随机访问(Clean Random Access, CRA)、断开链路访问(Broken Link Access, BLA)或瞬时解码刷新(Instantaneous Decoding Refresh, IDR)访问单元。

##### 随机访问支持

除了 IDR 图像，HEVC 的 IRAP 图像的 NAL 单元头部(通过 NAL 单元类型)中也包括信号。支持三种类型的 IRAP 图像，即 IDR、CRA 和 BLA 图像: IDR 图像通常称为封闭图像组(closed group-of-pictures, closed-GOP)随机访问点，而 CRA 和 BLA 图像通常称为开放图像组(open-GOP)随机访问点。BLA 图像通常源于 CRA 图像处两个比特流或其部分的拼接，例如在流切换期间。为了使系统更好地使用 IRAP 图像，总共定义六种不同的 NAL 单元来表示 IRAP 图像的属性，这些 NAL 单元可用于更好地匹配 ISOBMFF [IS014496-12](https://www.rfc-editor.org/rfc/rfc7798#ref-IS014496-12) [IS015444-12](https://www.rfc-editor.org/rfc/rfc7798#ref-IS015444-12) 中定义的流访问点类型，该类型用于 3GP-DASH [3GPDASH](https://www.rfc-editor.org/rfc/rfc7798#ref-3GPDASH) 和 MPEG-DASH [MPEGDASH](https://www.rfc-editor.org/rfc/rfc7798#ref-MPEGDASH) 中的随机访问支持。以解码顺序在 IRAP 图像之后、以输出顺序在 IRAP 图像之前的图像可参考用作与 IRAP 图像关联的前导图像。有两种类型的前导图像: 随机访问可解码前导(Random Access Decodable Leading, RADL)图像和随机访问跳过前导(Random Access Skipped Leading, RASL)图像。当在相关 IRAP 图像处开始解码时，RADL 图像是可解码的；当从相关的 IRAP 图像开始解码时，RASL 图像不可解码，通常会被丢弃。对于原始呈现的 RASL 图像已被丢弃的比特流，HEVC 提供了一些机制用来指定比特流的一致性。因此，系统组件可以在需要时丢弃 RASL 图像，而无需担心导致比特流不兼容。

##### 时间可伸缩性支持

HEVC 改进对时间可伸缩性的支持，通过在 NAL 单元头部包含 TemporalId 标志、限制特定时间子层的图像不能被较低时间子层的图像用于帧间预测参考、子比特流提取过程，以及要求每个子比特流提取输出是一致的比特流。媒体感知网络元素(Media-Aware Network Elements, MANE)可以基于时间可伸缩性，利用 NAL 单元头部的 TemporalId 进行流适配。

##### 时间子层交换支持

HEVC 通过 NAL 单元头部中的 NAL 单元类型指定时间子层访问(Temporal Sub-layer Access, TSA)和逐级时间子层访问(Step-wise Temporal Sub-layer Access, STSA)的标识。按照解码顺序，TSA 图像及其后的图像实现帧间预测参考，不使用该 TSA 图像之前，且 TemporalId 大于或等于该 TSA 图像的图像。TSA 图像使能在 TSA 图像处从直接较低的子层，向上切换到包含 TSA 图像的子层或任何较高的子层。STSA 图像不使用与其 TemporalId 相同的图像用作帧间预测参考。按照解码顺序，STSA 图像之后，且与其 TemporalId 相同的图像实现帧间预测参考，不使用该 STSA 图像之前，且与其 TemporalId 相同的图像。STSA 图像使能在 STSA 图像处从紧邻较低的子层向上切换到包含该 STSA 图像的子层。

##### 子层参考或非参考图像

HEVC 中参考/非参考图像的概念和标识不同于 H.264。在 H.264 中，如果图像可被任何其他图像用于帧间预测参考，则它是参考图画；否则，它是非参考图像，由 NAL 单元头部的两个比特标识。在 HEVC 中，只有当图像标记为“用于参考”时，才称为参考图像。此外，还引入了子层参考图像的概念。如果图像可被与其 TemporalId 相同的另一图像用于帧间预测参考，则该图像是子层参考图像；否则，它是一个子层非参考图像。图像是子层参考图像还是子层非参考图像都通过 NAL 单元类型值标识。

##### 扩展性

除了 NAL 单元头部中的 TemporalId，HEVC 还包括 NAL 单元头部六位层 ID 的标识，对于单层比特流，该 ID 必须等于 0。扩展机制包括在 VPS、SPS、图像参数集(PPS)、SEI NAL 单元、切片头部等。所有这些扩展机制以向后兼容的方式实现未来扩展，使得根据潜在的未来 HEVC 扩展编码的比特流可以馈送到随后的遗留解码器(例如，HEVC 版本 1 解码器)，并且随后的遗留解码器可以解码并输出基本层比特流。

##### 比特流提取

HEVC 包括比特流提取过程，作为整个解码过程的一个组成部分。比特流提取过程用于比特流一致性测试过程，这是 HRD 缓冲模型的一部分。

##### 参考图像管理

HEVC 的参考图像管理与 H.264 不同，包括参考图像标记和从解码图像缓冲区(Decoded Picture Buffer, DPB)移除以及参考图像列表构建(Reference Picture List Construction, RPLC)。H.264 中描述的基于滑动窗口加自适应内存管理控制操作(Memory Management Control Operation, MMCO)的参考图像标记机制不同，HEVC 指定了基于参考图像集(Reference Picture Set, RPS)的参考图像管理和标记机制，RPLC 由此基于 RPS 机制。RPS 由与图像相关的一组参考图像组成，由按照解码顺序在相关图像之前的所有参考图像组成，可用于相关图像或按照解码顺序在其之后的任何图像的帧间预测。参考图像集包括五个参考图像列表；RefPicSetStCurrBefore、RefPicSetStCurrAfter、RefPicSetStFoll、RefPicSetLtCurr 和 RefPicSetLtFoll。RefPicSetStCurrBefore、RefPicSetStCurrAfter 和 RefPicSetLtCurr 包含所有参考图像，可用于当前图像以及按解码顺序在其之后的一个或多个图像的帧间预测。RefPicSetStFoll 和 RefPicSetLtFoll 包含所有参考图像，不用于当前图像的帧间预测，但可用于按照解码顺序在其之后的一个或多个图像的帧间预测。RPS 提供 DPB 状态的“帧内编码”标识，而不是“帧间编码”标识，主要用于改进错误恢复能力。HEVC 中的 RPLC 过程基于 RPS，通过为每个参考索引标识 RPS 子集的索引；这个过程比 H.264 中的 RPLC 过程简单。

##### 超低延迟支持

HEVC 指定一个子图像级 HRD 操作，以支持所谓的超低延迟。该机制指定了一种标准兼容的方式，以使延迟减少到一个图像间隔以下。可以标识子图像级的编码图像缓冲区(Coded Picture Buffer, CPB)和 DPB 参数，并且指定将该信息用于 CPB 定时(其中 CPB 移除时间对应于解码时间)和 DPB 输出定时(显示时间)的推导。允许解码器在常规访问单元级操作 HRD，即使存在子图像级 HRD 参数。

##### 新 SEI 消息

HEVC 继承了许多 H.264 SEI 消息，并在语法和/或语义上进行了更改，使其适用于 HEVC。此外，以下段落简要回顾了一些新的 SEI 信息。

面向显示的 SEI 消息通知解码器建议在显示之前应用于裁剪的解码图像的变换，以便可以正确显示图像，例如以倒置的方式。

图像 SEI 消息的结构提供有关 NAL 单元类型、图像顺序计数值和图像序列的预测依赖性信息。例如，SEI 信息可用于总结一个丢失图像对其他图像的影响。

解码图像哈希 SEI 消息提供从解码图像的采样值导出的校验和。它可用于检测是否正确接收和解码图像。

活动参数集 SEI 消息包括活动视频参数集和活动序列参数集的 ID，可用于激活 VPS 和 SPSs。此外，SEI 消息包括以下指示:

1) 指示是否支持“完全随机可访问性”(如果支持，当从当前 CVS 开始随机访问时，通过完全丢弃解码顺序中较早的所有访问单元，解码剩余比特流所需的所有参数集都存在于剩余比特流中，并且剩余比特流中的所有编码图像都可以正确解码)；
2) 指示当前 CVS 是否没有参数集，用于更新另一个按照解码顺序位于之前的相同类型的参数集。参数集的更新是指使用相同的参数集 ID，但更改了一些其他参数。如果此属性对于比特流中的所有 CVS 都为 true，则可以在会话开始之前将所有参数集带外发送。

解码单元信息 SEI 消息提供关于解码单元的编码图像缓冲区移除延迟的信息。该消息可用于极低延迟缓冲操作。

区域刷新信息 SEI 消息可以与恢复点 SEI 消息(在 H.264 和 HEVC 中都存在)一起使用，以改进对渐进解码刷新的支持。这支持从帧间编码图像的随机访问，其中可以在按输出/显示顺序指定数量的图像之后，正确解码或恢复完整图像。

#### 1.1.3 并行处理支持

据报道，HEVC 的编码计算需求明显高于 H.264，加上市场需要对视频分辨率(空间和时间)不断提高，导致采用了专门用于子图像级别并行化的 VCL 编码工具。也就是说，并行化至少以整数个 CTU 的粒度发生。这种高级并行化的目标是多核 CPU 和 DSP 以及多处理器系统。在系统设计中，为了便于使用，这些工具需要信号支持，这在本文[第 7 节](#7-载荷格式参数)提供。本节简要概述了 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中可用的工具。

HEVC 包含的许多工具的设计都考虑了多核/多处理器架构中潜在的并行实现。具体来说，对于并行化，可以使用如下所述的四种图像分区策略。

切片是比特流片段，可以独立于同一图像中的其他切片进行重建(尽管通过循环过滤操作可能仍然存在相互依赖性)。切片是唯一可以用于并行化的工具，它在 H.264 中以几乎相同的形式提供。基于切片的并行化不需要太多处理器间或核间通信(除了解码预测编码图像时用于运动补偿的处理器间或核间数据共享，这通常比图像内预测导致的处理器间或核间数据共享重得多)，因为切片设计为可独立解码。然而，出于同样的原因，切片可能需要一些编码开销。此外，片(与下面提到的一些其他工具相比)还作为比特流分区的关键机制，以匹配最大传输单元( Maximum Transfer Unit, MTU)大小要求，这是因为片的图像内独立性以及每个常规片封装在其自己的 NAL 单元中。在许多情况下，并行化的目标和 MTU 大小匹配的目标可能会对图像中的切片布局提出矛盾的要求。这种情况的实现导致了下面提到的更先进工具的开发。

依赖的切片分段允许在 CTU 边界处将编码切片分片，而不破坏任何图像内预测机制。它们是对本文描述的分片机制的补充，因为依赖的切片分段需要编码器的配合。由于依赖的切片分段必然包含整数个 CTU，因此使用多核操作 CTU 的解码器可以处理依赖的切片分段，而无需与其他核通信此切片分段比特流的一部分。相反，本文中规定的分片并不保证分片包含整数个 CTU。

在波前并行处理(Wavefront Parallel Processing, WPP)中，图像被分割成若干行 CTU。熵解码和预测允许使用来自其他分区 CTU 的数据。通过并行解码 CTU 行可以实现并行处理，其中一行解码的开始延迟两个 CTU，以确保在解码主体 CTU 之前，主体 CTU 上方和右侧的 CTU 相关的数据可用。使用这种交错启动(当以图形表示时，它看起来像一个波前)，可以最多使用与图像中包含的 CTU 行数相同的处理器/内核数进行并行化。

由于允许在图像内相邻 CTU 行之间进行图像内预测，因此实现图像内预测所需的处理器间/核间通信可能是大量的。与未应用时相比，WPP 分区不会导致创建更多 NAL 单位；因此，WPP 不能用于 MTU 大小匹配，尽管切片可以组合使用。

平铺(tile)定义将图像划分为平铺列和行的水平和垂直边界。在按照图像的平铺光栅扫描顺序解码下一个平铺的左上角 CTU 之前，CTU 的扫描顺序更改为平铺内局部的(按照平铺的 CTU 光栅扫描顺序)。与切片类似，平铺破坏了图像预测依赖性(包括熵解码依赖性)。但是，它们不需要包含在单独的 NAL 单元(这方面与 WPP 相同)；因此，平铺不能用于 MTU 大小匹配，尽管可以组合使用切片匹配 MTU 大小。每个平铺可由一个处理器/核处理，并且处理单元解码相邻平铺之间的图像内预测所需的处理器/核间通信限于传送共享的切片头部(在切片跨越多个平铺的情况下)，以及重构采样和元数据共享的循环过滤相关的。到目前为止，由于两个相邻分区之间的图像内独立性，与 WPP 相比，平铺对处理器间通信带宽的要求更低。

#### 1.1.4 NAL 单元头

HEVC 对 H.264 的 NAL 单元概念进行了修改。HEVC 使用两字节的 NAL 单元头，如图 1 所示。NAL 单元的载荷指除 NAL 单元头之外的 NAL 单元。

图 1: HEVC NAL 单元头部结构

```txt
+---------------+---------------+
|0|1|2|3|4|5|6|7|0|1|2|3|4|5|6|7|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|F|   Type    |  LayerId  | TID |
+-------------+-----------------+
```

NAL 单元头部字段的语义如 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中所述，为方便起见，下文对其进行简要说明。除了每个字段的名称和大小外，[HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 还提供了相应的语法元素名称。

F(forbidden_zero_bit): 1 位。[HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 要求为零。请注意，在 NAL 单元头部包含该位是为了使能通过  MPEG-2 传输系统传输 HEVC 视频(避免模拟起始码) ^MPEG2S](https://www.rfc-editor.org/rfc/rfc7798#ref-MPEG2S)。本文中，值 1 可用于表示语法冲突，例如[第 4.4.3 节](#443-分片单元)所述，对于因聚合 一个 NAL 单元的多个分片单元但缺少最后一个分片而生成的 NAL 单元。

Type(nal_unit_type): 6 位。该字段指定 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 7-1 中定义的 NAL 单元类型。如果 NAL 单元该字段的最高有效位等于 0(即该字段的值小于 32)，则此 NAL 单元是 VCL NAL 单元。否则，NAL 单元是非 VCL NAL 单元。有关所有当前定义的 NAL 单元类型及其语义的参考，请参考 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 的第 7.4.2 节。

LayerId(nuh_layer_id): 6 位。[HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 要求为零。预计在本规范的未来可伸缩或三维视频编码扩展中，该语法元素将用于识别 CVS 中可能存在的附加层，其中层可以是例如空间可伸缩层、质量可伸缩层、纹理视图或深度视图。

TID（nuh_temporal_id_plus1）: 3 位。此字段指定 NAL 单元的时间标识符加 1。TemporalId 的值等于 TID 减去 1。TID 值为 0 是非法的，以确保 NAL 单元头部至少有一位等于 1，从而使能独立考虑 NAL 单元头部和 NAL 单元载荷数据中的起始码模拟。

### 1.2 载荷格式概述

此载荷格式定义了以下过程，用于通过 RTP [RFC3550](https://www.rfc-editor.org/rfc/rfc3550) 传输 HEVC 编码数据:

- 使用此载荷格式的 RTP 头部
- 使用三种载荷结构将 HEVC 编码的 NAL 单元打包成 RTP 数据包: 单 NAL 单元数据包、聚合数据包和分片单元
- 在单个 RTP 流或多个 RTP 流(在一个或多个RTP会话内)内传输同一比特流的 HEVC NAL 单元，其中在 RTP 流内，NAL 单元的传输可以是非交织(即，NAL 单元的传输顺序与其解码顺序相同)或交织(即，NAL 单元的传输顺序不同于解码顺序)
- 与会话描述协议(Session Description Protocol, SDP)一起使用的媒体类型参数 [RFC4566](https://www.rfc-editor.org/rfc/rfc4566)
- 一种载荷头部扩展机制和数据结构，用于基于该扩展机制增强对时间可伸缩性的支持

## 2 惯例

本文中的关键词“必须”、“不得”、“要求”、“应”、“不应”、“建议”、“可”和“可选”应按照 [RFC2119](https://www.rfc-editor.org/rfc/rfc2119) [BCP14](https://www.rfc-editor.org/bcp/bcp14) 中所述进行解释。

当处理位字段时，此规范使用设置和清除位。设置位等于该位赋值为 1(On)。清除位等于该位赋值为 0(Off)。

## 3 定义和缩写

本文使用 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 的术语和定义。方便起见，[第 3.1.1 节](#311-hevc-规范中的定义)列出了 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中的相关定义。[第 3.1.2 节](#312-本文的特定定义)提供了本文的特定定义。

### 3.1 定义

#### 3.1.1 HEVC 规范中的定义

##### 访问单元

access unit: 根据指定的分类规则相互关联的一组 NAL 单元，它们在解码顺序上是连续的，并且只包含一个编码图像。

##### BLA 访问单元

BLA access unit: 其中编码图像为 BLA 图像的访问单元。

##### BLA 图像

BLA picture: 每个 VCL NAL 单元的 nal_unit_type 等于 BLA_W_LP、BLA_W_RADL 或 BLA_N_LP 的 IRAP 图像。

##### 编码视频序列(CVS)

Coded Video Sequence: 一个访问单元序列，按解码顺序，由一个 NoRaslOutputFlag 等于 1 的 IRAP 访问单元，及其后 NoRaslOutputFlag 等于 1 的非 IRAP 访问单元的零个或多个访问单元组成，包括所有后续访问单元，直到不包括 NoRaslOutputFlag 等于 1 的 IRAP 访问单元。

  信息说明: IRAP 访问单元可以是 IDR 访问单元、BLA 访问单元或 CRA 访问单元。对于每个 IDR 访问单元、每个 BLA 访问单元和每个 CRA 访问单元，NoRaslOutputFlag 值等于 1，它们是比特流中以解码顺序排列的第一个访问单元，是以解码顺序排列在序列结束 NAL 单元之后的第一个访问单元，或者 HandleCraAsBlaFlag 等于 1。

##### CRA 访问单元

CRA access unit: 其中编码图像为 CRA 图像的访问单元。

##### CRA 图像

CRA picture: 每个 VCL NAL 单元的 nal_unit_type 等于 CRA_NUT 的 RAP 图像。

##### IDR 访问单元

IDR access unit: 其中编码图像为 IDR 图像的访问单元。

##### IDR 图像

IDR picture: 每个 VCL NAL 单元的 nal_unit_type 等于 IDR_W_RADL 或 IDR_N_LP 的 RAP 图像。

##### IRAP 访问单元

IRAP access unit: 其中编码图像为 IRAP 图像的访问单元。

##### IRAP 图像

IRAP picture: 每个 VCL NAL 单元的 nal_unit_type 在 BLA_W_LP(16) 到 RSV_IRAP_VCL23(23) 范围内的编码图像。

##### 层

layer: 一组 VCL NAL 单元，它们都具有特定的 nuh_layer_id 值和相关的非 VCL NAL 单元，或具有层次关系的一组语法结构之一。

##### 操作点

operation point: 通过操作子比特流提取过程从另一个比特流创建的比特流，使用另一个比特流、目标 TemporalId 和目标层标识符列表作为输入。

##### 随机访问

random access: 在比特流起始点以外的点开始比特流解码过程的行为。

##### 子层

sub-layer: 时间可伸缩比特流的时间可伸缩层，由具有特定 TemporalId 变量值的 VCL NAL 单元和相关的非 VCL NAL 单元组成。

##### 子层表示

sub-layer representation: 由特定子层和较低子层的 NAL 单元组成的比特流子集。

##### 平铺

tile: 图像中特定平铺列和特定平铺行内编码树块的矩形区域。

##### 平铺列

tile column: 编码树块的矩形区域，其高度等于图像的高度，宽度由图像参数集中的语法元素指定。

##### 平铺行

tile row: 编码树块的矩形区域，其高度由图像参数集中的语法元素指定，宽度等于图像的宽度。

#### 3.1.2 本文的特定定义

##### 被依赖 RTP 流

dependee RTP stream: 另一个 RTP 流所依赖的 RTP 流。单媒体传输多 RTP 流(Multiple RTP streams on a Single media Transport, MRST)或多媒体传输多 RTP 流(Multiple RTP streams on Multiple media Transports, MRMT)中的所有 RTP 流(最高 RTP 流除外)都是被依赖 RTP 流。

##### 最高 RTP 流

highest RTP stream: 没有其他 RTP 流依赖的 RTP 流。单媒体传输单 RTP 流(Single RTP stream on a Single media Transport, SRST)中的 RTP 流是最高 RTP 流。

##### 媒体感知网络元素(MANE)

Media-Aware Network Element: 一种网络元素，比如中间盒、选择性转发单元或应用层网关，能够解析 RTP 载荷头部或 RTP 载荷的某些方面，并对内容作出反应。

  信息说明: MANE 的概念超出了普通路由器或网关的范围，因为 MANE 必须了解标识(比如，了解媒体流的载荷类型映射)并在使用安全实时传输协议(Secure Real-time Transport Protocol, SRTP)时必须信任 MANE。使用 MANE 的优点是它们允许根据媒体编码的需要丢弃数据包。例如，如果某个 MANE 由于某条链路拥塞而不得不丢弃数据包，它可以识别并删除那些消除之后对用户体验产生最小不利影响的数据包。丢弃数据包后，MANE 必须重写 RTCP 数据包以匹配 RTP 流的更改，如 [RFC3550](https://www.rfc-editor.org/rfc/rfc3550) [第 7 节](#7-载荷格式参数)所述。

##### 媒体传输

Media Transport: 正如下面的 MRST、MRMT 和 SRST 定义中所使用的，媒体传输表示通过 5 元组(源地址、源端口、目标地址、目标端口、传输协议)标识的传输关系传输数据包。另见 [RFC7656](https://www.rfc-editor.org/rfc/rfc7656) [第 2.1.13 节](https://www.rfc-editor.org/rfc/rfc7656#section-2.1.13)。

  信息说明: 本文中的术语“比特流”等同于 [RFC7656](https://www.rfc-editor.org/rfc/rfc7656) 中的术语“编码流”。

##### 单媒体传输多 RTP 流(MRST)

Multiple RTP streams on a Single media Transport: 在单个传输上承载单个 HEVC 比特流的多个 RTP 流。另见 [RFC7656](https://www.rfc-editor.org/rfc/rfc7656) [第 3.5 节](https://www.rfc-editor.org/rfc/rfc7656#section-3.5)。

##### 多媒体传输多 RTP 流(MRMT)

Multiple RTP streams on Multiple media Transports, MRMT: 多个传输上承载单个 HEVC 比特流的多个 RTP 流。另见 [RFC7656](https://www.rfc-editor.org/rfc/rfc7656) [第 3.5 节](https://www.rfc-editor.org/rfc/rfc7656#section-3.5)。

##### NAL 单元解码顺序

NAL unit decoding order: NAL 单元顺序符合 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 第 7.4.2.4 节中给出的 NAL 单元顺序约束。

##### NAL 单元输出顺序

NAL unit output order: 一种 NAL 单元顺序，其中不同访问单元的 NAL 单元是访问单元对应的解码图像的输出顺序(正如 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 规定)，并且访问单元内的 NAL 单元按照其解码顺序。

##### 类 NAL 单元结构

NAL-unit-like structure: 一种与 NAL 单元相似的数据结构，即它也有一个 NAL 单元头和一个载荷，不同之处在于载荷不遵循起始码模拟预防机制，这是 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 第 7.3.1.1 节中规定的 NAL 单元语法所需的。本文定义的类 NAL 单元结构的示例为聚合数据包(Aggregation Packet, AP)、载荷内容信息(PAyload Content Information, PACI)和分片单元(Fragmentation Unit, FU)数据包的包载荷。

##### NALU 时间

NALU-time: 如果 NAL 单元将在其自己的 RTP 数据包中传输，则 RTP 时间戳将具有的值。

##### RTP 流

RTP stream: 请参阅 [RFC7656](https://www.rfc-editor.org/rfc/rfc7656)。在本文的范围内，一个 RTP 流用于传输一个或多个时间子层。

##### 单媒体传输单 RTP 流(SRST)

Single RTP stream on a Single media Transport: 单个(媒体)传输上承载单个 HEVC 比特流的单个 RTP 流。另见 [RFC7656](https://www.rfc-editor.org/rfc/rfc7656) [第 3.5 节](https://www.rfc-editor.org/rfc/rfc7656#section-3.5)。

##### 传输顺序

transmission order: 以 RTP 序列号(模运算)升序排列的数据包顺序。在聚合数据包内，NAL 单元传输顺序与数据包中 NAL 单元的出现顺序相同。

### 3.2 缩写

AP Aggregation Packet 聚合包

BLA Broken Link Access 断开链接访问

CRA Clean Random Access 干净随机访问

CTB Coding Tree Block 编码树块

CTU Coding Tree Unit 编码树单元

CVS Coded Video Sequence 编码视频序列

DPH Decoded Picture Hash 解码图像哈希

FU Fragmentation Unit 分片单元

HRD Hypothetical Reference Decoder 假设参考解码器

IDR Instantaneous Decoding Refresh 瞬时解码刷新

IRAP Intra Random Access Point 帧内随机访问点

MANE Media-Aware Network Element 媒体感知网络元素

MRMT Multiple RTP streams on Multiple media Transports 多媒体传输多 RTP 流

MRST Multiple RTP streams on a Single media Transport 单媒体传输多 RTP 流

MTU Maximum Transfer Unit 最大传输单元

NAL Network Abstraction Layer 网络抽象层

NALU Network Abstraction Layer Unit 网络抽象层单元

PACI PAyload Content Information 载荷内容信息

PHES Payload Header Extension Structure 载荷头扩展结构

PPS Picture Parameter Set 图像参数集

RADL Random Access Decodable Leading (Picture) 随机访问可解码前导(图像)

RASL Random Access Skipped Leading (Picture) 随机访问跳过前导(图像)

RPS Reference Picture Set 参考图像集

SEI Supplemental Enhancement Information 补充增强信息

SPS Sequence Parameter Set 序列参数集

SRST Single RTP stream on a Single media Transport 单媒体传输单 RTP 流

STSA Step-wise Temporal Sub-layer Access 逐级时间子层访问

TSA Temporal Sub-layer Access 时间子层访问

TSCI Temporal Scalability Control Information 时间可伸缩性控制信息

VCL Video Coding Layer 视频编码层

VPS Video Parameter Set 视频参数集

## 4 RTP 载荷格式

### 4.1 RTP 头部用法

RTP 头部格式在 [RFC3550](https://www.rfc-editor.org/rfc/rfc3550) 中定义(方便起见在图 2 重新绘制)。此载荷格式使用头部字段的方式和该规范一致。

对于聚合包和分片单元的RTP 载荷(以及某些 RTP 头部位的设置)分别在 4.4.2 和 4.4.3 节中指定。

图 2: 根据 [RFC3550](https://www.rfc-editor.org/rfc/rfc3550) 的 RTP 头部

```txt
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|V=2|P|X|   CC  |M|     PT      |       sequence number         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           timestamp                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           synchronization source (SSRC) identifier            |
+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
|            contributing source (CSRC) identifiers             |
|                           ....                                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

根据此 RTP 载荷格式设置 RTP 头信息如下:

- 标记位(Marker bit, M): 1 位。为当前 RTP 流携带的访问单元的最后一个数据包设置此位，符合视频格式中 M 位的正常使用，以允许有效的处理播放缓冲区。当使用 MRST 或 MRMT 时，如果一个访问单元出现在多个 RTP 流中，则访问单元每个 RTP 流的最后一个分组上设置标记位。

  信息说明: NAL 单元的内容不能说明 NAL 单元是否是访问单元的最后一个 NAL 单元(按解码顺序)。RTP发送者实现可从视频编码器获得该信息。然而，如果实现不能直接从编码器获得该信息，例如，当比特流被预编码，并且没有为每个 NAL 单元分配时间戳，那么，发送者实现可以检查后续(按解码顺序)的 NAL 单元，以便如下确定 NAL 单元是否是访问单元的最后一个 NAL 单元。如果 NAL 单元是比特流的最后一个 NAL 单元，则将其确定为访问单元的最后一个 NAL 单元。如果以下两个条件均为真，则 NAL 单元 naluX 也被确定为访问单元的最后一个 NAL 单元:
  
  1) 解码顺序中的下一个 VCL NAL 单元 naluY 在其 NAL 单元头之后的第一个字节的高阶位等于 1
  2) naluX 和 naluY 之间的所有 NAL 单元(当存在时)，nal_unit_type 在 32 到 35 之间(含 32 和 35)，等于 39，或在 41 到 44 之间(含 41 和 44)，或 48 到 55 之间(含 48 和 55)。

- 载荷类型(Payload type, PT): 7 位。为这种新的数据包格式分配 RTP 载荷类型超出本文档的范围，不在此处指定。载荷类型的分配必须通过使用的配置文件或以动态方式执行。
  
  信息说明: 对于 MRST 或 MRMT 中的不同 RTP 流，不需要使用不同的载荷类型值。

- 序列号(Sequence number, SN): 16 位。根据 [RFC3550](https://www.rfc-editor.org/rfc/rfc3550) 设置和使用。
- 时间戳(Timestamp): 32 位。RTP 时间戳设置为内容的采样时间戳。**必须**使用 90 kHz 的时钟频率。
  
  如果 NAL 单元没有自己的时间属性(比如参数集和 SEI NAL 单元)，则 RTP 时间戳设置为包含 NAL 单元的访问单元的基本编码图像的 RTP 时间戳(根据 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 的 7.4.2.4.4 章节)。

  接收者**必须**为显示过程使用 RTP 时间戳，即使比特流包含 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中规定的图像时序 SEI 消息或解码单元信息 SEI 消息。然而，这并不意味着应当丢弃比特流中的图像时序 SEI 消息，因为图像时序 SEI 消息可能包含帧场信息，在适当渲染隔行视频中是重要的。

- 同步源(SSRC): 32 位。用于标识 RTP 数据包的源。使用 SRST 时，根据定义，单个 SSRC 用于单个比特流的所有部分。在 MRST 或 MRMT 中，不同的 ssrc 用于每个 RTP 流，包含单个(时间可伸缩)比特流的子层子集的。接收者需要正确关联包含在同一比特流部分中的 SSRC 集。

### 4.2 载荷头部用法

RTP 数据包载荷的前两个字节称为载荷头部。如[第 1.1.4 节](#114-nal-单元头)所示，无论载荷结构的类型如何，载荷头部包含与NAL 单元头部相同的字段(F、Type、LayerId 和 TID)。

TID 值指示(除其他外) RTP 包的相对重要性，例如，因为属于较高时间子层的 NAL 单元不用于较低时间子层的解码。TID 值越低表示重要性越高。与不太重要的 NAL 单元相比，更重要的 NAL 单元可以更好地防止传输损耗。

### 4.3 传输模式

本文允许通过以下方式传输 HEVC 比特流:

- 单媒体传输单 RTP 流(SRST)
- 单媒体传输多 RTP 流(MRST)
- 多媒体传输多 RTP 流(MRMT)

  信息说明: 虽然本规范允许在 H.265 RTP 载荷内使用 MRST，但在撰写本文时，SDP Offer/Answer 内的 MRST 标识并未完全规定。参见 [RFC5576](https://www.rfc-editor.org/rfc/rfc5576) 和 [RFC5583](https://www.rfc-editor.org/rfc/rfc5583) 了解当前支持的内容，参见 [RTP-MULTI-STREAM](https://www.rfc-editor.org/rfc/rfc7798#ref-RTP-MULTI-STREAM) 和 [SDP-NEG](https://www.rfc-editor.org/rfc/rfc7798#ref-SDP-NEG) 了解未来的方向。

在 MRMT 中，一个 RTP 流对另一个 RTP 流的依赖性通常如 [RFC5583](https://www.rfc-editor.org/rfc/rfc5583) 中所述。[RFC5583](https://www.rfc-editor.org/rfc/rfc5583) 也可用于指定 MRST 内的依赖关系，但仅当 RTP 流使用不同的载荷类型时。

SRST 或 MRST **应该**应用于点对点单播场景，而 MRMT **应该**应用于点对多点多播场景，其中不同的接收者需要相同 HEVC 比特流的不同操作点，以提高带宽利用效率。

  信息说明: 在除一个接收者外的所有接收者都离开后，多播可降级为单播(这是第一个“应该”而不是“必须”的理由)，并且可能存在需要 MRMT 但不可能的情况，例如，当 IP 多播未部署在特定网络中时(这是第二个“应该”而不是“必须”的理由)。

传输模式由 tx-mode 媒体参数指示(见[第 7.1 节](#71-媒体类型注册))。如果 tx-mode 等于 “SRST”，则**必须**使用 SRST。否则，如果 tx-mode 等于 “MRST”，则**必须**使用 MRST。否则(tx-mode 等于 “MRMT”)，**必须**使用 MRMT。

  信息说明: 当 RTP 流不依赖于其他 RTP 流时，RTP 流可以使用 SRST、MRST 或 MRMT 中的任何一个。

接收者**必须**支持所有 SRST、MRST 和 MRMT。

  信息说明: 接收者对 MRMT 的必要支持并不意味着接收者必须支持多播。

### 4.4 载荷结构

定义了四种不同类型的 RTP 数据包载荷结构。接收者可以通过载荷头部中的 Type 字段识别 RTP 包载荷的类型。

四种不同的载荷结构如下所示:

- 单 NAL 单元数据包(Single NAL Unit Packet)：载荷中包含单个 NAL 单元，并且 NAL 单元的 NAL 头部 也用作载荷头部。[第 4.4.1 节](#441-单-nal-单元数据包)规定了该载荷结构。
- 聚合数据包(AP)：在一个访问单元中包含多个 NAL 单元。[第 4.4.2 节](#442-聚合包ap)规定了该载荷结构。
- 分片单元(FU)：包含单个 NAL 单元的子集。[第 4.4.3 节](#443-分片单元)规定了该载荷结构。
- PACI 承载 RTP 包(PACI carrying RTP packet): 包含一个载荷头部(出于效率与其他载荷头部不同)、一个载荷头部扩展结构(Payload Header Extension Structure, PHES)和一个 PACI 载荷。[第 4.4.4 节](#444-paci-包)规定了该载荷结构。

#### 4.4.1 单 NAL 单元数据包

单 NAL 单元数据包只包含一个 NAL 单元，它由一个载荷头部(表示为 PayloadHdr)、一个有条件的 16 位 DONL 字段(以网络字节顺序)和所包含 NAL 单元的 NAL 单元载荷数据(包括其 NAL 单元头部)组成，如图 3 所示。

图 3: 单 NAL 单元数据包的结构

```txt
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           PayloadHdr          |      DONL (conditional)       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|                  NAL unit payload data                        |
|                                                               |
|                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               :...OPTIONAL RTP padding        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

载荷头部**应该**是所包含 NAL 单元的 NAL 单元头部的精确副本。然而，例如，当希望将 CRA 图像处理为 BLA 图像时，Type(即 nal_unit_type)字段**可以**改变 [JCTVC-J0107](https://www.rfc-editor.org/rfc/rfc7798#ref-JCTVC-J0107)。

DONL 字段(当存在时)指定所包含 NAL 单元的解码顺序号的 16 个最低有效位的值。如果任何 RTP 流的 sprop-max-don-diff 大于 0，则**必须**存在 DONL 字段，并且所包含 NAL 单元的变量 DON 将被推导为等于 DONL 字段的值。否则(对于所有 RTP 流，sprop-max-don-diff 等于 0)，DONL 字段**不能**存在。

#### 4.4.2 聚合包(AP)

引入聚合包(AP)是为了减少小型 NAL 单元(如大多数非 VCL NAL 单元)的封包开销，这些 NAL 单元通常只有几个八位字节。

AP 在聚合一个访问单元内的 NAL 单元。AP 中要携带的每个 NAL 单元被封装在聚合单元中。在一个 AP 中聚合的 NAL 单元以 NAL 单元解码顺序。

AP 由一个载荷头(表示为 PayloadHdr)和其后两个或多个聚合单元组成，如图 4 所示。

图4: 聚合包的结构

```txt
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    PayloadHdr (Type=48)       |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
|                                                               |
|             two or more aggregation units                     |
|                                                               |
|                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               :...OPTIONAL RTP padding        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

载荷头部的字段设置如下：如果每个聚合 NAL 单元的 F 位等于零，则 F 位**必须**等于 0；否则，它**必须**等于 1。Type 字段**必须**等于 48。LayerId 的值**必须**等于所有聚合 NAL 单元中 LayerId 的最低值。TID 值**必须**是所有聚合 NAL 单元中 TID 的最低值。

  信息说明: AP 中的所有 VCL NAL 单元都具有相同的 TID 值，因为它们属于相同的访问单元。然而，AP 可能包含非 VCL NAL 单元，其中 NAL 单元头中的 TID 值可能不同于同一 AP 中 VCL NAL 单元的 TID 值。

AP **必须**携带至少两个聚合单元，并且可以根据需要携带任意多个聚合单元；然而，AP 中的数据总量显然**必须**适合 IP 数据包，并且**应该**选择大小，以使生成的 IP 数据包小于 MTU 大小，从而避免 IP 层分片。AP **不能**包含[第 4.4.3 节](#443-分片单元)中规定的 FU。AP 不得嵌套；例如，一个 AP 不得包含另一个 AP。

AP 中的第一个聚合单元由一个有条件的 16 位 DONL 字段(按网络字节顺序)和一个 16 位无符号大小信息(按网络字节顺序)组成，该信息表示 NAL 单元的大小(单位字节，不包括这两个八位字节，但包括 NAL 单元头)，然后是 NAL 单元本身，包括其 NAL 单元头，如图 5 所示。

图 5: AP 中第一个聚合单元的结构

```txt
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                :       DONL (conditional)      |   NALU size   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   NALU size   |                                               |
+-+-+-+-+-+-+-+-+         NAL unit                              |
|                                                               |
|                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

DONL 字段(当存在时)指定聚合的 NAL 单元的解码顺序号的 16 个最低有效位的值。

如果任何 RTP 流的 sprop-max-don-diff 大于 0，则 AP 中的第一个聚合单元**必须**存在 DONL 字段，并且推导聚合 NAL 单元的变量 DON 等于 DONL 字段的值。否则(对于所有 RTP 流，sprop-max-don-diff 等于0)，AP 中的第一个聚合单元**不能**存在 DONL 字段。

不是 AP 中第一个聚合单元的聚合单元由有条件的 8 位 DOND 字段和其后 16 位无符号大小信息(按网络字节顺序)组成，该信息表示 NAL 单元的大小(单位字节，不包括这两个八位字节，但包括 NAL 单元头)，其后是 NAL 单元本身，包括其 NAL 单元头，如图 6 所示。

图6: 不是 AP 中第一个聚合单元的聚合单元的结构

```txt
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                : DOND (cond)   |          NALU size            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|                       NAL unit                                |
|                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

当存在时，DOND 字段加 1 指定同一 AP 中当前聚合 NAL 单元和前一聚合 NAL 单元的解码顺序号值之间的差值。

如果任何 RTP 流的 sprop-max-don-diff 大于0，则不是 AP 中第一个聚合单元的聚合单元中**必须**存在 DOND 字段，并且推导聚合 NAL 单元的变量 DON 等于`(同一 AP 中先前聚合 NAL 单元的 DON + DOND + 1) % 65536`。否则(所有 RTP 流 sprop-max-don-diff 等于 0)，不是 AP 中第一个聚合单元的聚合单元中**不能**出现DOND 字段，在这种情况下，AP 中携带的 NAL 单元的传输顺序和解码顺序与 NAL 单元在 AP 中出现的顺序相同。

图 7 显示了一个 AP 示例，该 AP 包含两个聚合单元，在图中标记为 1 和 2，不存在 DONL 和 DOND 字段。

图 7: 包含两个聚合单元的 AP 数据包示例，其中没有 DONL 和 DOND 字段

```txt
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          RTP Header                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   PayloadHdr (Type=48)        |         NALU 1 Size           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          NALU 1 HDR           |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         NALU 1 Data           |
|                   . . .                                       |
|                                                               |

+               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  . . .        | NALU 2 Size                   | NALU 2 HDR    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| NALU 2 HDR    |                                               |
+-+-+-+-+-+-+-+-+              NALU 2 Data                      |
|                   . . .                                       |
|                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               :...OPTIONAL RTP padding        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

图 8 显示了一个 AP 示例，该 AP 包含两个聚合单元，在图中标记为 1 和 2，并且存在 DONL 和 DOND 字段。

图 8: 包含两个聚合单元的 AP 示例，其中包含 DONL 和 DOND 字段

```txt
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          RTP Header                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   PayloadHdr (Type=48)        |        NALU 1 DONL            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          NALU 1 Size          |            NALU 1 HDR         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|                 NALU 1 Data   . . .                           |
|                                                               |
+     . . .     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               |  NALU 2 DOND  |          NALU 2 Size          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          NALU 2 HDR           |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+          NALU 2 Data          |
|                                                               |
|        . . .                  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               :...OPTIONAL RTP padding        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

#### 4.4.3 分片单元

引入分片单元(FU)可将单个 NAL 单元分段为多个 RTP 数据包，可能无需配合或了解 HEVC 编码器。NAL 单元的分片由该 NAL 单元的整数个连续八位字节组成。同一 NAL 单元的分片**必须**以 RTP 序列号递增的连续顺序发送(在第一个分片和最后一个分片之间不能发送同一 RTP 流中的其他 RTP 数据包)。

当 NAL 单元被分片并在 FU 内传送时，它被称为分片 NAL 单元。AP **不能**被分片。FU **不能**嵌套；例如，一个 FU 不能包含另一个 FU 的子集。

携带 FU 的 RTP 包的 RTP 时间戳被设置为分片 NAL 单元的 NALU 时间。

FU 由载荷头(表示为 PayloadHdr)、一个八位字节的 FU 头、一个有条件 16 位 DONL 字段(以网络字节顺序)和一个 FU 载荷组成，如图 9 所示。

图 9: FU 的结构

```txt
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    PayloadHdr (Type=49)       |   FU header   | DONL (cond)   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-|
| DONL (cond)   |                                               |
|-+-+-+-+-+-+-+-+                                               |
|                         FU payload                            |
|                                                               |
|                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               :...OPTIONAL RTP padding        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

载荷头部的字段设置如下。Type 字段**必须**等于 49。字段 F、LayerId 和 TID **必须**分别等于分片 NAL 单元的字段 F、LayerId 和 TID。

FU 头由一个 S 位、一个 E 位和一个 6 位 FuType 字段组成，如图 10 所示。

图 10: FU 头的结构

```txt
+---------------+
|0|1|2|3|4|5|6|7|
+-+-+-+-+-+-+-+-+
|S|E|  FuType   |
+---------------+
```

FU 头字段的语义如下所示:

- S: 1 位。当设置为 1 时，S 位表示分片 NAL 单元的开始，即 FU 载荷的第一个字节也是分片 NAL 单元载荷的第一个字节。当 FU 载荷不是分片 NAL 单元载荷的开始时，S 位**必须**设置为 0。
- E: 1 位。当设置为 1 时，E 位表示分片 NAL 单元的结束，即载荷的最后一个字节也是分片 NAL 单元的最后一个字节。当 FU 载荷不是分片 NAL 单元的最后一个分片时，E 位**必须**设置为 0。
- FuType: 6位。字段 FuType **必须**等于分片 NAL 单元的 Type 字段。

DONL 字段(当存在时)指定分片 NAL 单元的解码顺序号的 16 个最低有效位的值。

如果任何 RTP 流的 sprop-max-don-diff 大于 0，且 S 位等于 1，则 FU 中**必须**存在 DONL 字段，并且推导分片 NAL 单元的变量 DON 等于 DONL 字段的值。否则(对于所有 RTP 流，sprop-max-don-diff 等于 0，或者 S 位等于 0)，FU 中**不能**存在 DONL 字段。

非分片 NAL 单元**不能**在一个 FU 中传输；例如，同一 FU 头部，起始位和结束位不得同时设置为 1。

FU 载荷由分片 NAL 单元的载荷的分片组成，因此，如果顺序连接连续 FU 的 FU 载荷(从 S 位等于 1 的 FU 开始，到 E 位等于 1 的 FU 结束)，则可以重构分片 NAL 单元的载荷。FU 载荷中不包括分片 NAL 单元的 NAL 单元头部，但是分片 NAL 单元的 NAL 单元头部的信息在 FU 的 FU 载荷头部的 F、LayerId 和 TID 字段，以及 FU 的 FU 头部的 FuType 字段中传送。FU 载荷**不能**为空。

如果 FU 丢失，则接收者**应该**按照传输顺序丢弃所有后续对应同一分片 NAL 单元的分片单元，除非已知接收者中的解码器准备好优雅地处理不完整的 NAL 单元。

端点或 MANE 中的接收者可以将 NAL 单元的前 n-1 个分片聚合为(不完整的) NAL 单元，即使没有接收到该 NAL 单元的分片 n。在这种情况下，NAL 单元的 forbidden_zero_bit 必须设置为 1，以指示语法冲突。

#### 4.4.4 PACI 包

本节指定 PACI 数据包结构。本文指定的基本载荷头部有意限制为 NAL 单元头部的 16 位，以便将打包开销保持在最小。然而，已经确定了一些情况，其中建议在数据包头部中容易访问的位置包括控制信息，尽管存在额外的开销。[第 4.5 节](#45-时间可扩展性控制信息)规定的 TSCI 就是此类控制信息之一。PACI 数据包携带这种和未来类似的结构。

PACI 数据包结构基于载荷头部扩展机制，该机制是通用的，可扩展以携带载荷头部扩展。在本节中，重点在于本规范中的使用。[第 4.4.4.2 节](#4442-paci-扩展资料性)为规范设计人员提供了如何在未来规范中使用扩展机制的指导。

PACI 数据包由载荷头部(表示为 PayloadHdr)组成，其结构如[第 4.2 节](#42-载荷头部用法)所述。载荷头后面是字段 A、cType、PHSsize、F[0..2]和Y。

图 11 显示了符合本文的 PACI 数据包，即没有任何扩展。

图 11: PACI 的结构

```txt
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    PayloadHdr (Type=50)       |A|   cType   | PHSsize |F0..2|Y|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        Payload Header Extension Structure (PHES)              |
|=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=|
|                                                               |
|                  PACI payload: NAL unit                       |
|                   . . .                                       |
|                                                               |
|                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               :...OPTIONAL RTP padding        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

载荷头部的字段设置如下。F 位**必须**等于0。Type 字段**必须**等于 50。LayerId 值**必须**是 PACI 载荷 NAL 单元或类 NAL 单元的结构的 LayerId 字段的副本。TID 的值**必须**是 PACI 载荷 NAL 单元或类 NAL 单元结构的 TID 字段的副本。

其他字段的语义如下所示:

- A: 1 位。拷贝PACI 载荷 NAL 单元或类 NAL 单元的结构的 F 位。
- cType: 6 位。拷贝 PACI 载荷 NAL 单元或类 NAL 单元结构的 Type 字段。
- PHSsize: 5 位。表示 PHES 字段的长度。该值限制为小于或等于 32 个八位字节，以简化 MTU 大小匹配的编码器设计。
- F0: 该字段等于 1，指定 PHE 中存在时间可伸缩性支持扩展。
- F1、F2: **必须**为 0，可用于将来的扩展，请参见[第 4.4.4.2 节](#4442-paci-扩展资料性)。符合此版本 HEVC 载荷格式的接收者**必须**忽略 F1=1 和/或 F2=1，并且忽略由 F1=1 和/或 F2=1 指示的 PHE 中的任何信息。

  信息说明: 接收者可以通过首先解码与F0=1相关联的信息，然后基于PHSsize的值跳过PHE的任何剩余字节来实现。

- Y: 1 位。**必须**为 0，可用于将来的扩展，请参见[第 4.4.4.2 节](#4442-paci-扩展资料性)。符合此版本 HEVC 载荷格式的接收者**必须**忽略 Y=1，并且忽略 Y 指示的 PHES 中的任何信息。
- PHES: 可变八位字节数。PHSsize 值指示的可变八位字节数。
- PACI 载荷: 要携带的单个 NAL 单元数据包或 类 NAL 单元结构(例如: FU 或 AP)，不包括前两个八位字节。
  
  信息说明: PACI 载荷中携带的 NAL 单元或类 NAL 单元结构的前两个八位字节不包括在 PACI 载荷中。相反，在 RTP 包的 PayloadHdr 位置复制相应的值。这种设计提供了两个优点: 首先，保留了载荷头部的整体结构，即不需要为 PACI 载荷头部结构实现特殊情况。其次，不引入额外的开销。

PACI 载荷**可以**是单个 NAL 单元、FU 或 AP。PACI **不能**被分片或聚合。以下小节记录了这些设计选择的原因。

##### 4.4.4.1 PACI 规则的原因(资料性)

PACI 不能被分片。如果一个 PACI 可以被分片，而第一个分片以外的分片丢失，那么就不可能访问 PACI 中的信息。因此，PACI 不能被分片。换言之，FU 不能携带 PACI(的碎片)。

PACI 不能被聚合。从压缩的角度来看，聚合 PACI 是不可取的，因为在许多情况下，几个待聚合的 NAL 单元将共享相同的 PACI 字段和值，这些字段和值将毫无理由地进行冗余携带。PACI 聚合的大部分(如果不是全部的话)实际效果可以通过聚合 NAL 单元并将其与 PACI 捆绑(见下文)来实现。因此，不得对 PACI 进行聚合。换句话说，AP 不得包含 PACI。

PACI 的载荷可以是分片。中间盒和带有不灵活(通常基于硬件)编码器的发送系统偶尔会发现自己处于 PACI 及其头部的组合大于 MTU 大小的情况。在这种情况下，中间盒或发送方可以对 NAL 单元进行分片，并将该分片封装在 PACI 中。这样做会保留所有分片的载荷头部扩展信息，从而允许下游中间盒和接收者利用该信息。因此，发送方可以将分片放入 PACI 中，接收者必须能够处理这样的 PACI。

PACI 的载荷可以是聚合 NAL 单元。HEVC 比特流可能包含大小不均和/或较小(与 MTU 大小相比)的 NAL 单元。为了有效地将这些小型 NAL 单元打包，引入了 AP。AP 的好处独立于载荷头部扩展的需要。因此，发送方可以将 AP 放入 PACI，接收者必须能够处理此类 PACI。

##### 4.4.4.2 PACI 扩展(资料性)

本节为未来的规范设计者提供了关于如何扩展 PACI 语法以适应未来扩展的建议。显然，设计者在设计时可以自由地指定任何适合他们的东西。然而，在下面描述的扩展机制中已经投入了大量的思想，我们建议与它的偏差有必要进行很好的解释。

本文仅定义了一个载荷头部扩展(TSCI，如[第 4.5 节](#45-时间可扩展性控制信息)所述)；因此，只有 F0 位承载语义。F1 和 F2 已经命名(而不仅仅像典型的视频规范设计者那样标记为保留)。它们旨在标记两个额外的扩展。Y 位允许递归地添加更多的 F 和 Y 位，以扩展机制超出三个可能的载荷头扩展。建议在为 F1、F2 或 Y 位分配不同于下面建议的语义时，定义一个新的数据包类型(使用不同的 Type 值)。

设置 Y 位时，在 Y 位之后插入 8 位 flag-extension。flag-extension 由 7 个标志 `F[n..n+6]`和另一个 Y 位组成。

基本 PACI 头部已经包括 F0、F1 和 F2。因此，第一个 flag-extension 中 `Fx` 位被编号为 F3、F4、…、F9；第二个 flag-extension 中的 F 位编号为 F10、F11、…、F16 等。因此，PACI 中始终至少有三个 `Fx` 位，但可以通过设置下一个 Y 位并添加八位 flag-extension (携带七个标志和另一个 Y 位)来增加 `Fx` 位(以及相关扩展类型)的数量。此标志列表的大小受[第 4.4.4 节](#444-paci-包)规定的限制(所有 flag-extension 和 PHES 信息组合为 32 个八位字节)。

每个 F 位可以指示载荷头部扩展结构(Payload Header Extension Structure, PHES)中存在或不存在某些信息。

当规范开发人员设计一种利用 PACI 扩展机制的新语法时，他/她必须遵循下面列出的约束条件；否则，可能会破坏扩展机制。

1) 为特定 `Fx` 位添加的字段的长度**必须**固定，并且**不能**依赖于设置的其他 `Fx` 位(没有解析依赖)。
2) 必须按顺序分配 `Fx` 位。
3) 对于任何值 n，支持第 n 个 `Fn` 位的实现必须理解字段 `Fk(k<n)` 的语法(但不一定是语义)，以便能够在出现这些位时使用它们，或者至少能够跳过它们。

### 4.5 时间可扩展性控制信息

本节描述了本规范中定义的单一载荷头部扩展，称为 TSCI。如果将来需要额外的载荷头部扩展，可以在本文档更新版本的本节中或在其自己的文档中指定这些扩展。

当在 PACI 中将 F0 设置为 1 时，指定 PHES 字段包括 TSCI 字 段 TL0PICIDX、IrapPicID、S 和 E，如下所示:

图 12: 含 TSCI 的 PHES 的 PACI 结构

```txt
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    PayloadHdr (Type=50)       |A|   cType   | PHSsize |F0..2|Y|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   TL0PICIDX   |   IrapPicID   |S|E|    RES    |               |
|-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               |
|                           ....                                |
|               PACI payload: NAL unit                          |
|                                                               |
|                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               :...OPTIONAL RTP padding        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

- TL0PICIDX(8 位): 当存在时，TL0PICIDX 字段**必须**设置为等于 temporal_sub_layer_zero_idx，[HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 第 D.3.22 节中针对 PACI 中包含 NAL 单元的访问单元规定。
- IrapPicID(8 位): 当存在时，**必须**将 IrapPicID 字段设置为等于 irap_pic_id，[HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 第 D.3.22 节中针对 PACI 中包含 NAL 单元的访问单元规定。
- S(1 位): 如果以下任一条件为真，则 S 位**必须**设置为 1，否则**必须**设置为 0:
  - PACI 载荷中的 NAL 单元是图像的第一个 VCL NAL 单元(按解码顺序)。
  - PACI 载荷中的 NAL 单元是 AP，并且第一个包含的聚合单元中的 NAL 单元是图像的第一个 VCL NAL 单元(按解码顺序)。
  - PACI 载荷中的 NAL 单元是 FU，且其 S 位等于 1，并且 FU 载荷包含图像的第一个 VCL NAL 单元的片段(按解码顺序)。
- E(1 位): 如果以下任一条件为真，则 E 位**必须**设置为 1，否则**必须**设置为 0:
  - PACI 载荷中的 NAL 单元是图像的最后一个 VCL NAL 单元(按解码顺序)。
  - PACI 载荷中的 NAL 单元是 AP，最后一个包含的聚合单元中的 NAL 单元是图像的最后一个 VCL NAL 单元(按解码顺序)。
  - PACI 载荷中的 NAL 单元是 FU，且其 E 位等于 1，并且 FU 载荷包含图像的最后一个 VCL NAL 单元的片段(按解码顺序)。
- RES(6 位): **必须**等于 0。保留供将来扩展。

PHSsize 的值**必须**设置为 3。接收者**必须**允许字段 F0、F1、F2、Y 和 PHSsize 的其他值，并且**必须**忽略除上述 PHES 中规定之外的任何其他字段(如果存在)。

### 4.6 解码顺序号

对于每个 NAL 单元，导出变量 AbsDon 表示解码顺序号，指示 NAL 单元解码顺序。

假设 NAL 单元 n 是 RTP 流中传输顺序的第 n 个NAL 单元。

如果对于承载 HEVC 比特流的所有 RTP 流，sprop-max-don-diff 等于 0，则推导 NAL 单元 n 的 AbsDon 值 `AbsDon[n]` 等于 n。

否则(对于任何 RTP 流，sprop-max-don-diff大于0)，`AbsDon[n]` 的推导如下，其中 `DON[n]` 是 NAL 单元 n 的变量 DON 的值:

- 如果 n 等于 0(即 NAL 单元 n 是传输顺序的第一个 NAL 单元)，则设置 `AbsDon[0]` 等于 `DON[0]`。
- 否则(n 大于 0)，以下适用于 `AbsDon[n]`  的推导:

```txt
如果 DON[n] == DON[n-1], AbsDon[n] = AbsDon[n-1]

如果 (DON[n] > DON[n-1] 且 DON[n] - DON[n-1] < 32768), AbsDon[n] = AbsDon[n-1] + DON[n] - DON[n-1]

如果 (DON[n] < DON[n-1] 且 DON[n-1] - DON[n] >= 32768), AbsDon[n] = AbsDon[n-1] + 65536 - DON[n-1] + DON[n]
  
如果 (DON[n] > DON[n-1] 且 DON[n] - DON[n-1] >= 32768), AbsDon[n] = AbsDon[n-1] - (DON[n-1] + 65536 - DON[n])

如果 (DON[n] < DON[n-1] 且 DON[n-1] - DON[n] < 32768), AbsDon[n] = AbsDon[n-1] - (DON[n-1] - DON[n])
```

对于任意两个 NAL 单元 m 和 n，以下各项适用:

- `AbsDon[n] > AbsDon[m]` 表示按照 NAL 单元解码顺序，NAL 单元 n 在 NAL 单元 m 之后。
- `AbsDon[n] = AbsDon[m]` 表示两个 NAL 单元的 NAL 单元解码顺序可以是任意顺序。
- `AbsDon[n] < AbsDon[m]` 表示按照 NAL 单元解码顺序，NAL 单元 n 在 NAL 单元 m 之前。

  信息说明: 当 NAL 单元解码顺序中的两个连续 NAL 单元具有不同的 AbsDon 值时，两个 AbsDon 值之间的绝对差值可能大于或等于 1。

  信息说明: 有多种原因允许 NAL 单元解码顺序中两个连续 NAL 单元的 AbsDon 值的绝对差值大于 1。不要求增加 1，因为在将 AbsDon 值与 NAL 单元相关联时，可能不知道是否所有 NAL 单元都要分发给接收者。例如，当网络中存在拥塞时，网关可能不转发更高子层的 VCL NAL 单元或某些 SEI NAL 单元。在另一示例中，预先发送预编码片段的第一个帧内编码图像以确保其在接收者中随时可用，并且在发送第一个帧内编码图像时，发起者不能确切知道在预编码片段的第一个帧内编码图像按照解码顺序跟随之前将编码多少 NAL 单元。因此，当传输预编码片段的第一个帧内编码图像的 NAL 单元时，必须估计其 AbsDon 值，并且 AbsDon 值可能出现间隔。另一个示例是 sprop-max-don-diff 大于 0 的 MRST 或 MRMT，其中 AbsDon 值必须指示所有 RTP 流中传输的 NAL 单元的跨层解码顺序。

## 5 打包规则

以下打包规则适用:

- 如果任何 RTP 流的 sprop-max-don-diff 大于 0，则 RTP 流中携带的 NAL 单元的传输顺序**可能**不同于 NAL 单元解码顺序和 NAL 单元输出顺序。否则(对于所有 RTP 流，sprop-max-don-diff 等于 0)，RTP 流中携带的 NAL 单元的传输顺序**必须**与 NAL 单元解码顺序相同，并且当 tx-mode 等于“MRST”或“MRMT”时，也**必须**与 NAL 单元输出顺序相同。
- 小尺寸的 NAL 单元**应该**与一个或多个其他 NAL 单元一起封装在聚合包中，以避免小 NAL 单元不必要的打包开销。例如，非 VCL NAL 单元(如访问单元定界符、参数集或 SEI NAL 单元)通常很小，并且通常可以与 VCL NAL 单元聚合而不违反 MTU 大小约束。
- 在可能的情况下，从 MTU 大小匹配的角度来看，每个非 VCL NAL 单元**应该**与其关联的 VCL NAL 单元一起封装在聚包中，因为如果关联的 VCL NAL 单元不可用，通常非 VCL NAL 单元将毫无意义。
- 为了在 RTP 数据包中只携带一个 NAL 单元，**必须**使用单 NAL 单元数据包。

## 6 解包过程

解包背后的一般概念是从 RTP 流的 RTP 包和 RTP 流所依赖的所有 RTP 流(如果有)中获取 NAL 单元，并按照 NAL 单元解码顺序将它们传递给解码器。

解包过程取决于实现。因此，以下描述应视为合适实现的示例。对于相同输入，只要输出与下面描述的过程相同，也可以使用其他方案。当输出 NAL 单元集及其顺序都相同时，输出是相同的。相对于所描述算法的优化是可能的。

所有与缓冲区管理相关的正常 RTP 机制都适用。特别是，重复或过期的 RTP 包(通过 RTP 序列号和 RTP 时间戳指示)被删除。为了确定解码的确切时间，必须考虑诸如可能的故意延迟之类的因素以允许正确的流间同步。

NAL 单元类型值在 0 到 47(含)范围内的 NAL 单元可以传递给解码器。NAL 单元类型值在 48 到 63(含)范围内的类 NAL 单元结构**不能**传递给解码器。

接收者包含接收者缓冲区以补偿单个 RTP 流内和跨 RTP 流的传输延迟抖动，将 NAL 单元从传输顺序重新排序为 NAL 单元解码顺序，并在适用时恢复 MRST 或 MRMT 中的 NAL 单元解码顺序。在本节中，接收者操作是在没有 RTP 流内和跨 RTP 流传输延迟抖动的假设下描述的。为了将此接收者缓冲区与也用来补偿传输延迟抖动的实际接收者缓冲区区分开来，本节中接收者缓冲区在下文被称为解交织缓冲区。接收者还应为传输延迟抖动做准备；也就是说，或者为传输延迟抖动缓冲和解交织缓冲保留单独的缓冲区，或者将接收者缓冲区同时用于传输延迟抖动和解交织。此外，接收者应该在缓冲操作中考虑传输延迟抖动，例如，在开始解码和点播之前通过额外的初始缓冲。

当所有接收到的 RTP 流的 sprop-max-don-diff 等于 0 时，解交织缓冲区大小为零字节，并且本段剩余部分描述的过程适用。当仅接收到一个 RTP 流时，单个 RTP 流中携带的 NAL 单元以其传输顺序直接传递给解码器，这与它们的解码顺序相同。当接收到多个 RTP 流时，多个 RTP 流中携带的 NAL 单元以其 NTP 时间戳顺序传递给解码器。当不同 RTP 流存在具有相同 NTP 时间戳的的多个 NAL 单元时，将它们传递给解码器的顺序是它们的依赖顺序，其中被依赖 RTP 流的 NAL 单元在依赖 RTP 流的 NAL 单元之前传递给解码器。当相同 RTP 流具有相同 NTP 时间戳的的多个 NAL 单元时，将它们传递给解码器的顺序是它们的传输顺序。

  信息说明: RTP 和 NTP 时间戳之间的映射在 RTCP SR 数据包中传输。此外，[RFC6051](https://www.rfc-editor.org/rfc/rfc6051) 中讨论的更快的媒体时间戳同步机制可用于加快获取 RTP 到墙壁时钟的映射。

对于任何接收到的 RTP 流，当 sprop-max-don-diff 大于 0 时，本节剩余部分描述的过程适用。

接收者有两个缓冲状态：初始缓冲和播放时缓冲。初始缓冲发生接收初始化时。在初始缓冲之后，开始解码和点播，然后使用播放时缓冲模式。

无论何种缓冲状态，接收者按照接收顺序将传入的 NAL 单元存储在解交织缓冲区中。RTP 数据包中携带的 NAL 单元分别存储在解交织缓冲区中。为每个 NAL 单元计算 AbsDon 值并保存该值。当使用 MRST 或 MRMT 时，一个比特流的所有 RTP 流的 NAL 单元存储在同一解交织缓冲区中。当任意两个 RTP 流中携带的 NAL 单元可放入解交织缓冲区时，首先将依赖关系树中较低的 RTP 流中携带的 NAL 单元放入缓冲区。例如，如果 RTP 流 A 依赖 RTP 流 B，则 RTP 流 B 携带的 NAL 单元首先被放入缓冲区。

初始缓冲持续到条件 A(解交织缓冲区中 NAL 单元的最大和最小 AbsDon 值之间的差值大于或等于最高 RTP 流的 sprop-max-don-diff 值)或条件 B(解交织缓冲区中的 NAL 单元数大于 sprop-depack-buf-nalus 值)为真。

初始缓冲后，每当条件 A 或条件 B 为真时，重复执行以下操作，直到条件 A 和条件 B 都变为假

- 从解交织缓冲区中将具有最小值 AbsDon 的 NAL 单元移除并传递给解码器。

当没有更多的 NAL 单元流入解交织缓冲区时，从解交织缓冲区中将剩余的所有 NAL 单元移除，并按照 AbsDon 值增加的顺序传递给解码器。

## 7 载荷格式参数

本节规定了**可能**使用的参数，用于选择载荷格式的可选特性以及比特流或 RTP 流的某些特性或属性。此处指定的参数是 HEVC 编解码器的媒体类型注册的一部分。也为使用 SDP 的应用提供了参数到会话描述协议(SDP) [RFC4566](https://www.rfc-editor.org/rfc/rfc4566) 的映射。对于不使用 SDP 的控制协议，也可在别处定义等效参数。

### 7.1 媒体类型注册

HEVC 编解码器的媒体子类型是从 IETF 树中分配的。

媒体类型名称: video

媒体子类型名称: H265

必要参数: 无

#### **可选**参数

##### profile-space, tier-flag, profile-id, profile-compatibility-indicator, interop-constraints 和 level-id

这些参数表示 RTP 流和 RTP 流所依赖的所有 RTP 流所承载的比特流的配置、层、默认级别和一些约束，或者表示接收者支持的配置、层、默认级别和一些约束的特定集合。

配置和一些约束由 profile-space、profile-id、profile-compatibility-indicator 和 interop-constraints 共同表示。配置指定了编码工具的子集，这些工具可能已用于生成比特流或接收者支持的比特流。

  信息说明: profile-id 有 32 个值，profile-compatibility-indicator 中有 32 个标志，每个标志对应一个 profile-id 值。根据 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 的 HEVC 版本 1，当一个比特流设置 32 个标志中的一个以上时，该比特流将符合与设置标志对应的所有配置。然而，在 [HEVCv2](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVCv2) 中的 HEVC 版本 2 草案中，A.3.5 小节中规定了 19 个格式范围扩展(Format Range Extensions)配置，所有配置都使用相同的 profile-id(4) 值，由 interop-constraints 中的 48 位中的一些位进行区分；这(相当意外的配置标识)意味着 32 个标志之一可能对应多个配置。为了将来能够支持任何 HEVC 扩展配置(可能使用 profile-space、profile-id、profile-compatibility-indicator 和 interop-constraints 指定和指示)，在 SDP offer/answer 中要求对称使用这些参数是安全的，除非 SDP answer 中包含 recv-sub-layer-id，用于选择提供的子层之一。

层由 tier-flag 指示。默认级别由 level-id 表示。生成比特流或接收者支持的比特流时，层和默认级别指定遵循的语法元素值或语法元素值的算术组合的限制。

对于任何解码器符合由 ptlB 指示的配置、层、级别和约束，如果可以解码符合 ptlA 指示的配置、层、级别和约束的任何比特流，则称 profile-space、tier-flag、profile-id、profile-compatibility-indicator、interop-constraints 和 level-id 参数集 ptlA 与这些参数集 ptlB 一致。

在 SDP offer/answer 中，当 SDP answer 不包括 recv-sub-layer-id 参数小于 SDP offer 中 sprop-sub-layer-id 时，以下情况适用:

- profile-space、tier-flag、profile-id、profile-compatibility-indicator 和 interop-constraints 参数**必须**对称使用，即 offer 中每个参数的值必须与 answer 中的值相同，无论是显式标识还是隐式推断。
- 只要 answer 指示的最高级别等于或低于 offer，level-id 参数就是可更改的。请注意，最高级别由 level-id 和 max-recv-level-id 共同表示。

在 SDP offer/answer 中，当 SDP answer 包含的 recv-sub-layer-id 参数小于 SDP offer 中的 sprop-sub-layer-id 时，answer 中包含的 profile-space、tier-flag、profile-id、profile-compatibility-indicator、interop-constraints 和 level-id 参数集，**必须**与 SDP offer 中指示的所选子层表示保持一致，但 SDP answer 中的 level-id 参数可以更改，只要 answer 中指示的最高级别低于或等于 offer。

下面提供了这些参数的更多规范，包括它们与 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中指定的配置、层和等级语法元素的值的关系。

###### profile-space, profile-id

profile-space 的值**必须**在 0 到 3 (含)之间。profile-id 的值必须在 0 到 31 (含)之间。

如果不存在 profile-space，则**必须**推断值为 0。当 profile-id 不存在时，**必须**推断值为 1(即主配置)。

当用于指示比特流的属性时，profile-space 和 profile-id 是从 SPS 或 VPS NAL 单元中的配置、层和级别语法元素派生出来的，如下所示，其中 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中指定了 general_profile-space、general_profile-idc、`sub_layer_profile-space[j]` 和 `sub_layer_profile-idc[j]`:

如果 RTP 流是最高的 RTP 流，则以下情况适用:

- profile-space = general_profile_space
- profile-id = general_profile_idc

否则(RTP 流是被依赖  RTP 流)，以下内容适用，j 是 sprop-sub-layer-id 参数的值:

- profile-space = `sub_layer_profile_space[j]`
- profile-id = `sub_layer_profile_idc[j]`

###### tier-flag, level-id

tier-flag 的值**必须**在 0 到 1 (含)的范围内。level-id 的值必须在 0 到 255(含)之间。

如果 tier-flag 和 level-id 参数用于指示比特流的属性，则它们指示比特流所遵循的层和最高级别。

如果 tier-flag 和 level-id 参数用于能力交换，则以下情况适用。如果 max-recv-level-id 不存在，则 level-id 定义的默认级别表示编解码器希望支持的最高级别。否则，max-recv-level-id 表示编解码器支持接收的最高级别。对于接收或发送，还**必须**支持低于支持的最高级别的所有级别。

如果不存在 tier-flag，则**必须**推断值为 0；如果不存在 level-id，则**必须**推断值为 93(即级别 3.1)。

当用于指示比特流的属性时，tier-flag 和 level-id 参数是从 SPS 或 VPS NAL 单元中的配置、层和级别语法元素派生出来的，如下所示，其中 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中指定了 general_tier_flag、general_level_idc、`sub_layer_tier_flag[j]` 和 `sub_layer_level_idc[j]`:

如果 RTP 流是最高的 RTP 流，则以下情况适用:

- tier-flag = general_tier_flag
- level-id = general_level_idc

否则(RTP 流是被依赖 RTP 流)，以下内容适用，j 是 sprop-sub-layer-id 的值:

- tier-flag = `sub_layer_tier_flag[j]`
- level-id = `sub_layer_level_idc[j]`

###### interop-constraints

六字节数据的 base16 [RFC4648](https://www.rfc-editor.org/rfc/rfc4648) (十六进制)表示，由 progressive_source_flag、interlaced_source_flag、non_packed_constraint_flag、frame_only_constraint_flag 和 reserved_zero_44bits 组成。

如果 interop-constraints 参数不存在，则**必须**推断以下内容:

- progressive_source_flag = 1
- interlaced_source_flag = 0
- non_packed_constraint_flag = 1
- frame_only_constraint_flag = 1
- reserved_zero_44bits = 0

当 interop-constraints 参数用于指示比特流的属性时，以下情况适用，其中general_progressive_source_flag、general_Intersected_source_flag、general_non_packed_constraint_flag、general_non_packed_constraint_flag、general_frame_only_constraint_flag、reserved_zero_44bits、`sub_layer_progressive_source_flag[j]`、`sub_layer_interlaced_source_flag[j]`、`sub_layer_non_packed_constraint_flag[j]`、`sub_layer_frame_only_constraint_flag[j]` 和 `sub_layer_reserved_zero_44bits[j]` 在 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中指定:

如果 RTP 流是最高的 RTP 流，则以下情况适用:

- progressive_source_flag = general_progressive_source_flag
- interlaced_source_flag = general_interlaced_source_flag
- non_packed_constraint_flag = general_non_packed_constraint_flag
- frame_only_constraint_flag = general_frame_only_constraint_flag
- reserved_zero_44bits = general_reserved_zero_44bits

否则(RTP 流是被依赖 RTP 流)，以下内容适用，j 是 sprop-sub-layer-id 的值:

- progressive_source_flag = `sub_layer_progressive_source_flag[j]`
- interlaced_source_flag = `sub_layer_interlaced_source_flag[j]`
- non_packed_constraint_flag = `sub_layer_non_packed_constraint_flag[j]`
- frame_only_constraint_flag = `sub_layer_frame_only_constraint_flag[j]`
- reserved_zero_44bits = `sub_layer_reserved_zero_44bits[j]`

对能力交换使用 interop-constraints 会导致任何比特流都需要符合 interop-constraints。

###### profile-compatibility-indicator

四字节数据的 base16 [RFC4648](https://www.rfc-editor.org/rfc/rfc4648) 表示。

当 profile-compatibility-indicator 用于指示比特流的属性时，以下内容适用，[HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中指定了 `general_profile_compatibility_flag[j]` 和 `sub_layer_profile_compatibility_flag[i][j]`:

  在这种情况下，profile-compatibility-indicator 指示由比特流符合的 profile-space、profile-id和 interop-constraints 定义的配置的其他配置。符合比特流符合的所有配置中的任何配置的解码器将能够解码比特流。这些额外的配置由 profile-space、profile-compatibility-indicator 的每个设置位和 interop-constraints 定义。

  如果 RTP 流是最高的 RTP 流，则以下适用于 0 到 31 (含)范围内 j 的每个值:

- profile-compatibility-indicator 第 j 位 = `general_profile_compatibility_flag[j]`

  否则( RTP 流是被依赖  RTP 流)，以下适用于 i 等于 sprop-sub-layer-id，以及 0 到 31(含)范围内的每个 j 值:

- profile-compatibility-indicator 第 j 位 = `sub_layer_profile_compatibility_flag[i][j]`

将 profile-compatibility-indicator 用于能力交换会导致要求任何比特流符合 profile-compatibility-indicator。这旨在处理任何未来 HEVC 配置被定义为两个或多个配置相交的情况。

如果此参数不存在，则此参数默认为以下值: profile-compatibility-indicator 第 j 位(j 等于 profile-id)被推断为等于 1，所有其他位被推断为等于0。

##### sprop-sub-layer-id

此参数**可**用于指示比特流中允许的最高 TID 值。如果不存在，则 sprop-sub-layer-id 的值将被推断为等于 6。

sprop-sub-layer-id 的值**必须**在 0 到 6 (含)的范围内。

##### recv-sub-layer-id

该参数**可**用于标识接收者对于 sprop-vps 中提供或声明的子层表示的选择。recv-sub-layer-id 的值表示接收者支持的比特流的最高子层的 TID。当不存在时，recv-sub-layer-id 的值被推断为等于 SDP offer中 sprop-sub-layer-id 的值。

recv-sub-layer-id 的值**必须**在 0 到 6 (含)的范围内。

##### max-recv-level-id

此参数**可**用于指示接收者支持的最高级别。接收者支持的最高级别等于 `max-recv-level-id/30`。

max-recv-level-id 的值**必须**在 0 到 255 (含)的范围内。

当 max-recv-level-id 不存在时，将推断该值等于 level-id。

当接收者支持的最高级别不高于默认级别时，max-recv-level-id **不能**出现。

##### tx-mode

此参数指示传输模式是 SRST、MRST 还是 MRMT。

tx-mode 的值**必须**等于 “SRST”、“MRST” 或 “MRMT”。当不存在时，tx-mode 的值被推断为等于 “SRST”。

如果该值等于 “MRST”，则**必须**使用 MRST。否则，如果该值等于 “MRMT”，则**必须**使用 MRMT。否则(该值等于 “SRST”)，**必须**使用  SRST。

对于 MRST 中的所有 RTP 流，tx-mode 的值**必须**等于 “MRST”。.

对于 MRMT 中的所有 RTP 流，tx-mode 的值**必须**等于 “MRMT”。

##### sprop-vps

该参数**可**用于传输比特流的任何视频参数集 NAL 单元，以用于视频参数集的带外传输。该参数还**可**用于能力交换和指示子流特征(即 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中定义的子层表示的属性)。参数值是 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 第 7.3.2.1 节规定的视频参数集 NAL 单元的 base64 [RFC4648](https://www.rfc-editor.org/rfc/rfc4648) 表示的逗号('，')分隔列表。

sprop-vps 参数**可以**包含一个或多个视频参数集 NAL 单元。但是，sprop-vps 参数中包含的所有其他视频参数集**必须**与 sprop-vps 参数中第一个视频参数一致。如果任何解码器符合 vpsA 中第一个 `profile_tier_level( )`语法结构中从语法元素 general_profile_space 到语法元素 general_level_idc(含) 12 字节数据指示的配置、层、级别和约束的比特流，可以解码符合 vpsB 中第一个 `profile_tier_level( )`语法结构中从语法元素 general_profile_space 到语法元素 general_level_idc(含) 12 字节数据指示的配置、层、级别和约束的比特流，则称视频参数集 vpsB 与另一视频参数集 vpsA 一致。

##### sprop-sps

该参数**可**用于传输比特流的序列参数集 NAL 单元，以用于序列参数集的带外传输。参数值是 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) [第 7.3.2.2 节](https://www.rfc-editor.org/rfc/rfc7798#section-7.3.2.2)规定的序列参数集 NAL 单元 base64 [RFC4648](https://www.rfc-editor.org/rfc/rfc4648) 表示的逗号('，')分隔列表。

##### sprop-pps

该参数**可**用于传输比特流的图像参数集 NAL 单元，以用于图像参数集的带外传输。参数值是 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 第 7.3.2.3 节规定的图像参数集 NAL 单元 base64 [RFC4648](https://www.rfc-editor.org/rfc/rfc4648) 表示的逗号('，')分隔列表。

##### sprop-sei

该参数**可**用于传输描述比特流特征的一个或多个 SEI 消息。当存在时，解码器可以在会话的整个持续时间内依赖 SEI 消息中描述的比特流特征，独立于 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中指定的 SEI 消息的持久性范围。

参数值 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 第 7.3.2.4 节规定的 SEI NAL 单元 base64 [RFC4648](https://www.rfc-editor.org/rfc/rfc4648) 表示的逗号('，')分隔列表。

  信息说明: 此处无意指定适用或不适用的 SEI 消息列表。在 sprop-sei 中传输某些 SEI 消息在某些应用场景中可能是合理的，而在其他应用场景中可能是无意义的。然而，下面描述了几个示例:

  1) 在比特流是从基于胶片的源材料创建的，并且在会话的生存期内不会发生拼接的环境中，胶片纹理特征 SEI 消息或色调映射信息 SEI 消息可能是有意义的，在 sprop-sei 而不是比特流每个入口点发送它们可能有助于节省比特，并允许只配置一次渲染器，从而避免不必要的失真。
  2) sprop-sei 中的图像信息 SEI 消息的结构可用于通知解码器关于 NAL 单元类型、图像顺序计数值和图像序列的预测相关性的信息。掌握这些知识有助于错误恢复。
  3) 在 sprop-sei 中传输无意义的 SEI 消息的示例包括解码图像散列 SEI 消息(几乎不可能所有解码图像都具有相同的散列标签)、当设备是手持设备时的显示方向 SEI 消息(当手持设备转动时，显示方向可能会改变)或填充载荷 SEI 消息(因为 SDP 中更多位是无意义的)。

##### max-lsr, max-lps, max-cpb, max-dpb, max-br, max-tr, max-tc

这些参数**可**用于标识接收者实现的能力。这些参数**不能**用于任何其他目的。最高级别(由 max-recv-level-id 指定)**必须**是接收者完全能够支持的最高级别。max-lsr、max-lps、max-cpb、max-dpb、max-br、max-tr 和 max-tc **可**用于指示接收者扩展最高级别所需能力的能力，如下所述。

当集合中存在多个参数(max-lsr、max-lps、max-cpb、max-dpb、max-br、max-tr、max-tc)时，接收者**必须**同时支持所有标识的能力。例如，如果存在 max-lsr 和 max-br，则

支持扩展图像速率和比特率的最高级别。也就是说，接收者能够解码比特流，其中 luma 采样率高达 max-lsr(含)，比特率高达 max-br(含)，编码图像缓冲区大小的导出在如下 max-br 参数的语义中指定，并且其他属性符合 max-recv-level-id 指定的最高级别。

  信息说明: 当使用**可选**媒体类型参数来标识比特流的属性，并且不存在 max-lsr、max-lps、max-cpb、max-dpb、max-br、max-tr 和 max-tc时，那么 profile-space、tier-flag、profile-id、profile-compatibility-indicator、interop-constraints 和 level-id 必须始终确保比特流完全符合指定的配置、层和级别。

###### max-lsr

max-lsr 的值是一个整数，表示最大处理速率，以每秒的 luma 采样数为单位。max-lsr 参数标识接收者能够以高于最高级别要求的速率解码视频。

当标识 max-lsr 时，接收者**必须**能够解码符合最高级别的比特流，但 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 A-2 中最高级别的 MaxLumaSR 值替换为 max-lsr 值除外。发送者**可以**使用此知识以高于最高级别指示的图像速率发送给定大小的图像。

当不存在时，推断 max-lsr 值等于 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 A-2 中最高级别给出的 MaxLumaSR 值。

max-lsr 的值**必须**在 MaxLumaSR 到 `16*MaxLumaSR`(含)的范围内，其中 MaxLumaSR  在 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 的表 A-2 最高级别给出。

###### max-lps

max-lps 的值是一个整数，表示最大图像大小，以 luma 采样数为单位。max-lps 参数标识接收者能够解码大于最高级别要求的图像大小。当标识 max-lps 时，接收者**必须**能够解码符合最高级别的比特流，但以下情况除外: [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 A-1 中最高级别的 MaxLumaPS 值替换为 max-lps 值。发送者**可以**使用此知识以合适的低于最高级别指示的图像速率发送较大的图像。

当不存在时，推断 max-lps 值等于 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 A-1 中最高级别给出的 MaxLumaPS 值。

max-lps 的值**必须**在 MaxLumaPS 到 `16*MaxLumaPS`(含)的范围内，其中 MaxLumaPS 在 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 的表 A-1 最高级别给出。

###### max-cpb

max-cpb 的值是一个整数，表示最大编码图像缓冲区大小，VCL HRD 参数以 CpbBrVclFactor 比特为单位，且 NAL HRD 参数以 CpbBrNalFactor 比特为单位，其中 CpbBrVclFactor 和 CpbBrNalFactor 在 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 第 A.4 节定义。max-cpb 参数标识接收者的内存大于最高级别所需的最小编码图像缓冲内存。当标识 max-cpb 时，接收者**必须**能够解码符合最高级别的比特流，但 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 A-1 中最高级别的 MaxCPB 值替换为 max-cpb 值的情况除外。发送方**可以**利用此知识构造编码比特流，其比特率变化比 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 A-1 中的 MaxCPB 值更大。

当不存在时，推断 max-cpb 值等于 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 A-1 中最高级别给出的 MaxCPB 值。

max-cpb 的值**必须**在 MaxCPB 到 `16*MaxCPB`(含)的范围内，其中 MaxLumaCPB 在 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 的表 A-1 最高级别给出。

  信息说明: 编码图像缓冲区用于假设参考解码器([HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 的附录 C)。建议在 HEVC 编码器中使用假设参考解码器，以验证生成的比特流是否符合标准并控制输出比特率。因此，编码图像缓冲区在概念上独立于接收者中的任何其他潜在缓冲区，包括解包和去抖动缓冲区。[HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 附录 C 中规定的解码器中不需要实现编码图像缓冲区，但是符合标准的解码器可以具有任何缓冲安排，前提是它们可以解码符合标准的比特流。因此，在实践中，视频解码器的输入缓冲区可以与接收者的解分组和解抖动缓冲区整合。

###### max-dpb

max-dpb 的值是一个整数，表示最高级别的 MaxLumaPS 处最大解码图像缓冲区大小(单位为解码图像)，即最高级别定义的最大图像大小处的解码图像数量。max-dpb 的值**必须**分别在 1 到 16 之间。max-dpb 参数标识接收者的内存大于默认情况下所需的最小解码图像缓冲内存，即 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中定义的 MaxDpbPicBuf(等于 6)。当标识 max-dpb 时，接收者**必须**能够解码符合最高级别的比特流，但 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中定义值为 6 的 MaxDpbPicBuff 被替换为 max-dpb 值除外。因此，标识 max-dpb 的接收者**必须**能够在其解码图像缓冲区中存储以下数量的解码图像(MaxDpbSize):

```txt
if( PicSizeInSamplesY <= ( MaxLumaPS >> 2 ) )
  MaxDpbSize = Min( 4 * max-dpb, 16 )
else if ( PicSizeInSamplesY <= ( MaxLumaPS >> 1 ) )
  MaxDpbSize = Min( 2 * max-dpb, 16 )
else if ( PicSizeInSamplesY <= ( ( 3 * MaxLumaPS ) >> 2
) )
  MaxDpbSize = Min( (4 * max-dpb) / 3, 16 )
else
  MaxDpbSize = max-dpb
```

其中，[HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 A-1 中给出的最高级别和 PicSizeInSamplesY 的 MaxLumaPS 是每个解码图像的当前大小，单位为 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中定义的 luma 采样。

max-dpb 的值**必须**大于或等于 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中定义的 MaxDpbPicBuf(即 6)。发送者**可以**使用此知识构造改进压缩的编码比特流。

当不存在时，推断 max-dpb 的值等于 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中定义的 MaxDpbPicBuf 值(即 6)。

  信息说明: 添加此参数主要是为了补充 ITU-T 建议 H.245 中的类代码点，以便于信令网关设计。解码图像缓冲区存储重建的采样。解码图像缓冲区的大小与 RTP 使用的缓冲区之间没有关系，尤其是解包和去抖动缓冲区。

###### max-br

max-br 的值是一个整数，表示最大视频比特率，VCL HRD 参数以每秒 CpbBrVclFactor 比特为单位，且 NAL HRD 参数以每秒 CpbBrNalFactor 比特为单位，其中 CpbBrVclFactor 和 CpbBrNalFactor 在 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 第 A.4 节定义。

max-br 参数标识接收者的视频解码器能够以高于最高级别要求的比特率解码视频。

当标识 max-br 时，接收者的视频编解码器**必须**能够解码符合最高级别的比特流，但在最高级别指定的限制内有以下例外情况:

- max-br 值替换 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 A-2 中最高级别的 MaxBR 值。
- 当 max-cpb 参数不存在时，以下公式的结果将替换 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 A-1 中的 MaxCPB 值:`(最高级别的 MaxCPB) * max-br / (最高级别的 MaxBR)`

例如，如果接收者标识主配置级别 2 的能力为 max-br 等于 2000，则表示 VCL HRD 参数的最大视频比特率为 2000 kb/s，NAL HRD 参数的最大视频比特率为 2200 kb/s，CPB 大小为 2000000 比特(`2000000/1500000*1500000`)。

发送方**可以**使用此知识发送比 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 附录 A 定义的级别允许的更高比特率视频，以实现更高的视频质量。

当不存在时，推断 max-br 值等于 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 A-2 中给出的最高级别的 MaxBR 值。

max-br 的值**必须**在 MaxBR 到 `16*MaxBR`(含)的范围内，其中最高级别的 MaxBR 在 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 的表 A-2 中给出。

  信息说明: 添加此参数主要是为了补充 ITU-T 建议 H.245 中的类代码点，以便于信令网关设计。根据该参数的值，不能假设网络能够在任何给定时间处理此类比特率。特别地，不能得出在拥塞控制约束下标识的比特率是可能的结论。

###### max-tr

max-tr 的值是一个整数，表示平铺行的最大数量。max-tr 参数标识接收者能够解码的视频的的平铺行数比最高级别允许的值更大。

当标识 max-tr 时，接收者**必须**能够解码符合最高级别的比特流，但 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 A-1 中最高级别的 MaxTileRows 值被替换为 max-tr 值除外。

发送方**可以**使用此知识发送图像，使用的平铺行数超过最高级别允许的值。

当不存在时，推断 max-tr 的值等于 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 A-1 中给出的最高级别的 MaxTileRows 值。

max-tr 的值**必须**在 MaxTileRows 到 `16*MaxTileRows`(含)的范围内，其中最高级别的 MaxTileRows 在 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 的表 A-1 中给出。

###### max-tc

max-tc 的值是一个整数，表示平铺列的最大数量。max-tc 参数标识接收者能够解码的视频的的平铺列数比最高级别允许的值更大。

当标识 max-tc 时，接收者**必须**能够解码符合最高级别的比特流，但 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 A-1 中最高级别的 MaxTileCols 值被替换为 max-tc 值除外。

发送方**可以**使用此知识发送图像，使用的平铺列数超过最高级别允许的值。

当不存在时，推断 max-tc 的值等于 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 表 A-1 中给出的最高级别的 MaxTileCols 值。

max-tc 的值**必须**在 MaxTileCols 到 `16*MaxTileCols`(含)的范围内，其中最高级别的 MaxTileCols 在 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 的表 A-1 中给出。

##### max-fps

max-fps 的值是一个整数，表示接收者可以有效处理的最大图像速率，单位为每 100 秒的图像。max-fps 参数**可以**用于标识接收者具有的约束，即接收者不能以全图像速率有效地处理视频，由最高级别和 max-lsr、max-lps 和 max-br 中的一个或多个参数(当存在时)暗示。

max-fps 的值不一定是可以发送最大图像大小的图像速率，它构成了对所有分辨率的最大图像速率的约束。

  信息说明: max-fps 参数在语义上与 max-lsr、max-lps、max-cpb、max-dpb、max-br、max-tr 和 max-tc 不同，因为 max-fps 用于标识约束，从而降低了其他参数所暗示的最大图像速率。

编码器**必须**使用等于或小于此值的图像速率。在没有 max-fps 参数的情况下，编码器可以根据最高级别和任何标识的可选参数自由选择任何图像速率。

max-fps 的值**必须**小于或等于全图像速率，由最高级别和 max-lsr、max-lps 和 max-br 中的一个或多个参数(当存在时)暗示。

##### sprop-max-don-diff

如果 tx-mode 等于 “SRST”，并且没有 NAL 单元 naluA 在传输顺序上被解码顺序上在 naluA 之前的任何NAL 单元跟随(即，NAL 单元的传输顺序与解码顺序相同)，则此参数的值**必须**等于 0。

否则，如果 tx-mode 等于 “MRST” 或 “MRMT”，则所有 RTP 流的 NAL 单元的解码顺序与 NAL 单元传输顺序和 NAL 单元输出顺序相同，则该参数的值**必须**等于 0 或 1。

否则，如果 tx-mode 等于 “MRST” 或 “MRMT”，并且所有 RTP 流的 NAL 单元的解码顺序与 NAL 单元传输顺序相同，但与 NAL 单元输出顺序不同，则该参数的值必须等于 1。

否则，此参数指定任意两个 NAL 单元 naluA 和 naluB 的解码顺序号值之间的最大绝对差值(即 AbsDon)，其中 naluA 在解码顺序上紧跟在 naluB 之后，在传输顺序上紧跟在 naluB 之前。

sprop-max-don-diff 的值**必须**是介于 0 到 32767(含)之间的整数。

不存在时，推断 sprop-max-don-diff 的值等于0。

##### sprop-depack-buf-nalus

此参数指定传输顺序在 NAL 单元之前且解码顺序在该 NAL 单元之后的 NAL 单元的最大数量。

sprop-depack-buf-nalus 的值**必须**是介于 0 到 32767(含)之间的整数。

如果不存在，则推断 sprop-depack-buf-nalus 的值等于0。

存在 sprop-max-don-diff 且大于 0 时，此参数**必须**存在且值**必须**大于 0。

##### sprop-depack-buf-bytes

此参数标识解交织缓冲区的所需大小，以字节为单位。参数值**必须**大于或等于[第 6 节](#6-解包过程)规定的解交织缓冲区的最大缓冲区占用率(以字节为单位)。

sprop-depack-buf-bytes 的值必须是介于 0 到 4294967295(含)之间的整数。

存在 sprop-max-don-diff 且大于 0 时，此参数**必须**存在且值**必须**大于0。如果不存在，则推断 sprop-depack-buf-bytes 值等于 0。

  信息说明: sprop-depack-buf-bytes 的值仅表示解交织缓冲区所需的大小。当网络抖动可能发生时，还必须提供大小合适的抖动缓冲区。

##### depack-buf-cap

该参数标识接收者实现的能力，并指示接收者可用的解包缓冲区空间量，以字节为单位，用于从一个或多个 RTP 流携带的 NAL 单元重构 NAL 单元解码顺序。接收者能够处理任何 RTP 流，并且 RTP 流所依赖的所有 RTP 流(当存在时)，这些流的 sprop-depack-buf-bytes 参数值小于或等于此参数。

如果不存在，则推断 depack-buf-cap 值等于 4294967295。depack-buf-cap 值必须是介于 1 到4294967295(含)之间的整数。

  信息说明: depack-buf-cap 仅表示接收者的解交织缓冲区的最大可能大小，未考虑网络抖动。

##### sprop-segmentation-id

此参数**可**用于标识比特流中存在的和可用于并行化的分段工具。sprop-segmentation-id 值必须是 0 到 3(含)范围内的整数。如果不存在，则推断 sprop-segmentation-id 值等于 0。

sprop-segmentation-id 等于 0 时，不提供有关分段工具的信息。sprop-segmentation-id 等于 1 时，表示比特流中存在切片。sprop-segmentation-id 等于 2 时，表示比特流中存在平铺。sprop-segmentation-id 等于 3 时，表示比特流中使用了 WPP。

##### sprop-spatial-segmentation-idc

[HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中规定的语法元素 min_spatial_segmentation_idc 的 base16 [RFC4648](https://www.rfc-editor.org/rfc/rfc4648) 表示形式。该参数**可**用于描述比特流的并行化能力。

##### dec-parallel-cap

该参数**可**用于指示解码器的附加解码能力，前提是比特流中存在支持并行解码的工具，例如切片、平铺和 WPP。解码器的解码能力可随比特流中存在的并行解码工具的设置而变化，例如，比特流中存在的平铺的大小。因此，可以提供多个能力点，每个能力点指示与并行性要求相关的最小所需解码能力，并行性要求是比特流上实现并行解码的要求。

每个能力点定义为一个组合，包括 1) 并行性要求、2) 配置(由 profile-space 和 profile-id 确定)、3) 最高级别和 4)可能等于或大于最高级别确定的最大处理速率、最大图像大小和最大视频比特率。ABNF [RFC5234](https://www.rfc-editor.org/rfc/rfc5234) 中的参数语法如下:

```txt
dec-parallel-cap = "dec-parallel-cap={" cap-point *(","
                  cap-point) "}"
        
cap-point = ("w" / "t") ":" spatial-seg-idc 1*(";"
            cap-parameter)
        
spatial-seg-idc = 1*4DIGIT ; (1-4095)
        
cap-parameter = tier-flag / level-id / max-lsr
                / max-lps / max-br
        
tier-flag = "tier-flag" EQ ("0" / "1")
        
level-id  = "level-id" EQ 1*3DIGIT ; (0-255)
        
max-lsr = "max-lsr" EQ 1*20DIGIT ; (0- 18,446,744,073,709,551,615)

max-lps = "max-lps" EQ 1*10DIGIT ; (0-4,294,967,295)
        
max-br = "max-br" EQ 1*20DIGIT ; (0- 18,446,744,073,709,551,615)

EQ = "="
```

由 dec-parallel-cap 参数表示的能力点集包含在一对花括号(`{}`)中。每两个连续的能力点组合用逗号(`,`)分隔。在每个功能点中，每两个连续参数组合以及它们的值(如果存在)用分号(`;`)分隔。

所有能力点的配置由 profile-space 和 profile-id 确定，它们位于 dec-parallel-cap 参数之外。

每个能力点以平行度要求的指示开始，该指示由平行工具类型(可能等于 `w` 或 `t`)和 spatial-seg-idc 参数的十进制值组成。当类型为 `w` 时，能力点仅对使用 WPP 的 H.265 比特流有效，即 entropy_coding_sync_enabled_flag 等于 1。当类型为 `t` 时，能力点仅对未使用 WPP 的 H.265 比特流有效(即 entropy_coding_sync_enabled_flag 等于 0)。能力点仅对 min_spatial_segmentation_idc 等于或大于 spatial-seg-idc 的 H.265 比特流有效。

在并行性要求指示后，每个能力点继续是一对或多对参数和值，是以下任何参数的任何顺序:

- tier-flag
- level-id
- max-lsr
- max-lps
- max-br

在每个能力点内，上述五个参数最多允许出现一次。

能力点的 dec-parallel-cap.tier-flag 和 dec-parallel-cap.level-id 值表示能力点的最高级别。能力点的 dec-parallel-cap.max-lsr、dec-parallel-cap.max-lps 和 dec-parallel-cap.max-br 值表示最大处理速率(以每秒的 luma 采样为单位)、最大图像大小(以 luma 采样为单位)和最大视频比特率(VCL HRD 参数以每秒 CpbBrVclFactor 比特为单位，NAL HRD 参数以每秒 CpbBrNalFactor 比特为单位，其中 CpbBrVclFactor 和 CpbBrNalFactor 在 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 第 A.4 节定义)。

如果不存在，推断 dec-parallel-cap.tier-flag 值等于 dec-parallel-cap 参数外部的 tier-flag 的值。如果不存在，推断 dec-parallel-cap.level-id 值等于 dec-parallel-cap 参数之外的 max-recv-level-id 的值。如果不存在，则推断 dec-parallel-cap.max-lsr、dec-parallel-cap.max-lps 或 dec-parallel-cap.max-br 值分别等于 dec-parallel-cap 参数之外的 max-lsr、max-lps 或 max-br 的值。

一般解码能力由 dec-parallel-cap 之外的一组参数表示，定义为通过以下参数组合确定的能力点: 1) 对应比特流 sprop-segmentation-id 值等于 0 的并行性要求，2) 由 profile-space、rofile-id、profile-compatibility-indicator 和 interop-constraints 确定的配置，3) 由 tier-flag 和 max-recv-level-id 确定的层和最高级别，以及 4) 由最高级别确定的最大处理速率、最大图像大小和最大视频比特率。一般解码能力**不能**包含在 dec-parallel-cap 参数中的能力点集。

例如，以下参数表示 720p30(级别 3.1)的一般解码能力加上 1080p30(级别 4)的附加解码能力，前提是比特流使用的空间上最大平铺或切片等于或小于图像大小的 1/3:

```txt
a=fmtp:98 level-id=93;dec-parallel-cap={t:8;level- id=120}
```

对于另一个示例，以下参数使用 dec-parallel-cap.max-lsr 和 dec-parallel-cap.max-lps 表示 1080p30 的附加解码能力，前提是比特流使用了 WPP:

```txt
a=fmtp:98 level-id=93;dec-parallel-cap={w:8;
            max-lsr=62668800;max-lps=2088960}
```

  信息说明: 当比特流中存在 min_spatial_segmentation_idc 且未使用 WPP 时，[HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 指定在包含超过 `4*PicSizeInSamplesY/(min_spatial_segmentation_idc+4)` luma 采样的比特流中不存在切片或平铺。

##### include-dph

该参数用于指示比特流中利用或包括解码图像散列(DPH) SEI 消息(见 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 第 D.3.19 节)的能力和偏好。DPH SEI 消息可用于检测图像损坏，以便接收者可以请求图像修复，请参阅[第 8 节](#8-与反馈消息一起使用)。该值是支持或请求使用的哈希类型的逗号分隔的列表，每个哈希类型使用无符号整数值(0-255)提供，哈希类型从最优先到最不优先列出。示例: `include-dph=0,2` 表示 MD5(首选)和校验和(次优先)的能力。如果未包含参数或该值不包含哈希类型，则假定没有能力利用 DPH SEI 消息。注意，即使没有使用它们的能力声明时，比特流仍然可以包括 DPH SEI 消息，因为通常 SEI 消息不会影响标准解码过程，并且允许解码器忽略 SEI 消息。

#### 编码注意事项

此类型仅定义为通过 RTP([RFC3550](https://www.rfc-editor.org/rfc/rfc3550)) 传输。

#### 安全考虑

参见 [RFC7798](https://www.rfc-editor.org/rfc/rfc7798) [第 9 节](https://www.rfc-editor.org/rfc/rfc7798#section-9)。

#### 已发布的规范

请参考 [RFC7798](https://www.rfc-editor.org/rfc/rfc7798) 及其[第 12 节](https://www.rfc-editor.org/rfc/rfc7798#section-12)。

#### 其他信息

无。

#### 文件扩展名

无。

#### Macintosh 文件类型代码

无。

#### 对象标识符或 OID

无。

#### 联系人和电子邮件地址，以获取更多信息

Ye-Kui Wang (yekui.wang@gmail.com)

#### 预期用途

普通

#### 作者

参见 [RFC7798](https://www.rfc-editor.org/rfc/rfc7798) 的作者地址部分。

#### 更改控制器

IESG 授权的 IETF 音频/视频传输载荷工作组。

### 7.2 SDP 参数

接收者**必须**忽略本文中未指定的任何参数。

#### 7.2.1 载荷类型参数到 SDP 的映射

将媒体类型 `video/H265` 字符串映射到会话描述协议(SDP) [RFC4566](https://www.rfc-editor.org/rfc/rfc4566) 中的字段，如下所示:

- SDP 的 `m=` 行的媒体名称**必须**是 `video`。
- SDP 的 `a=rtpmap` 行的编码名称**必须**是 `H265`(媒体子类型)。
- `a=rtpmap` 行的时钟频率**必须**为 90000。
- **可选**参数 profile-space、profile-id、tier-flag、level-id、interop-constraints、profile-compatibility-indicator、sprop-sub-layer-id、recv-sub-layer-id、max-recv-level-id、tx-mode、max-lsr、max-lps、max-cpb、max-dpb、max-br、max-tr、max-tc、max-fps、sprop-max-don-diff、sprop-depack-buf-nalus、sprop-depack-buf-bytes、depack-buf-cap、sprop-segmentation-id、sprop-spatial-segmentation-idc、dec-parallel-cap 和 include-dph (如果存在)必须包含在 SDP 的 `a=fmtp` 行。此参数表示为媒体类型字符串，形式是以分号分隔的`参数=值`对列表。
- **可选**参数 sprop-vps、sprop-sps 和 sprop-pps (如果存在)**必须**包含在 SDP 的 `a=fmtp` 行，或使用 [RFC5576](https://www.rfc-editor.org/rfc/rfc5576) [第 6.3 节](https://www.rfc-editor.org/rfc/rfc5576#section-6.3)规定的 `fmtp` 源属性进行传输。对于特定媒体格式(即 RTP 载荷类型)，sprop-vps、sprop-sps 或 sprop-pps **不能**既包含在 SDP 的 `a=fmtp` 行，又同时使用 `fmtp` 源属性进行传输。当包含在 SDP 的 `a=fmtp` 行时，这些参数表示为媒体类型字符串，形式是以分号分隔的`参数=值`对列表。当在 SDP 的 `a=fmtp` 行传输特定载荷类型时，参数 sprop-vps、sprop-sps 和 sprop-pps **必须**应用于该载荷类型的每个 SSRC。当使用 `fmtp` 源属性进行传输时，这些参数仅与作为 `fmtp` 源属性一部分的给定源和载荷类型相关联。

  信息说明: 使用 `fmtp` 源属性传输 sprop-vps、sprop-sps 和 sprop-pps 允许在拓扑中带外传输参数集，(如 [RFC7667](https://www.rfc-editor.org/rfc/rfc7667) 中规定的拓扑视频开关 MCU)。

SDP中的媒体表示示例如下:

```txt
m=video 49170 RTP/AVP 98
a=rtpmap:98 H265/90000
a=fmtp:98 profile-id=1;
          sprop-vps=<video parameter sets data>
```

#### 7.2.2 与 SDP Offer/Answer 模型一起使用

当提供的 HEVC 通过 RTP 在 Offer/Answer 模型 [RFC3264](https://www.rfc-editor.org/rfc/rfc3264) 中使用 SDP，以协商单播使用时，以下限制和规则适用:

- 标识 HEVC 媒体格式配置的参数包括 profile-space、profile-id、tier-flag、level-id、interop-constraints、profile-compatibility-indicator 和 tx-mode。当 answerer 的 answer 不包括媒体格式(载荷类型)的 recv-sub-layer-id 或包含的 recv-sub-layer-id 等于 offer 中的 sprop-sub-layer-id 时，这些媒体配置参数(level-id 除外)**必须**对称使用。answerer **必须**:

1) 保持媒体格式(载荷类型)所有配置参数的值与 offer 中的值相同，但 level-id 的值可以更改，只要 answer 指示的最高级别不高于 offer 指示的最高级别；
2) 在媒体格式(载荷类型) answer 中包括 recv-sub-layer-id 参数，其值小于 offer 中的 sprop-sub-layer-id，并维护所有配置参数，其值与所选子层表示的 sprop-vps 标识的相同，但 level-id 的值可以更改，只要 answer 指示的最高级别不高于所选子层表示的 offer 中 sprop-vps 指示的级别；或
3) 完全删除媒体格式(载荷类型)(当一个或多个参数值不受支持时)。

  信息说明: 上述对称使用要求不适用于 level-id，也不适用于其他比特流或 RTP 流属性和能力参数。

- profile-compatibility-indicator(当作为 sendonly 提供时)描述比特流属性。answerer **可以**接受 RTP 载荷类型，即使解码器不能处理由 profile-space、profile-id 和 interop-constraints 参数指示的配置，但能够处理由 profile-space、profile-compatibility-indicator 和 interop-constraints 指示的任何配置。但是，当 profile-compatibility-indicator 用于 recvonly 或 sendrecv 媒体描述时，使用此 RTP 载荷类型的比特流需要符合由 profile-space、profile-compatibility-indicator 和 interop-constraints 指示的所有配置。
- 为了简化这些配置的处理和匹配，answer 中使用的 RTP 载荷类型编号还**应**与 offer 中使用的相同，如 [RFC3264](https://www.rfc-editor.org/rfc/rfc3264) 所述。
- 当 answer 包括 recv-sub-layer-id 时，answer 中使用的 RTP 载荷类型编号**必须**与媒体子类型 H265 offer 中相同。当 answer 不包括 recv-sub-layer-id 时，answer 中**不能**包含媒体子类型 H265 offer 中使用的载荷类型编号，除非配置与 offer 中的配置完全相同，或者 answer 与 offer 中的配置只有 level-id 值不同。如果 HEVC 比特流包含多个操作点(使用时间可伸缩性和子层)，且 offer 中包含 sprop-vps，子层的信息存在于 sprop-vps 包含的第一个视频参数集中，则 answer **可以**包含 recv-sub-layer-id 参数。如果 offer 中提供了 sprop-vps，则 answerer **可以**选择 sprop-vps 包含的第一个视频参数集中指示的特定操作点。当 answer 包含的 recv-sub-layer-id 小于 offer 中的 sprop-sub-layer-id，SDP answer 中 sprop-vps 参数中包含的所有视频参数集，以及为 offerer-to-answerer 方向或 answerer-to-offerer 方向在带内发送的所有视频参数集，**必须**与 offer 的 sprop-vps 参数中的第一个视频参数集一致(参见本文[第 7.1 节](#71-媒体类型注册)中 sprop-vps 的语义，关于一个视频参数集与另一个视频参数集一致)，并且任一方向发送的比特流**必须**符合所选子层表示的配置、层、级别和约束，正如 offer 的 sprop-vps 参数集中第一个视频参数的第一个 profile_tier_level() 语法结构指示。

  信息说明: 当 offerer 收到不包括 recv-sub-layer-id 的 answer 时，必须根据媒体类型(即 `Video/H265`)和上述媒体配置参数，将 offer 中未声明的载荷类型与其已声明的任何载荷类型进行比较。这将使其能够确定所讨论的配置是新的还是与已经提供的配置等效，因为 answer 中可能会使用不同的载荷类型编号。执行操作点选择的能力使得接收者能够利用 HEVC 比特流的时间可伸缩性。

- 参数 sprop-max-don-diff、sprop-depack-buf-nalus 和 sprop-depack-buf-bytes 描述 offerer 或 answerer 正在发送媒体格式配置的 RTP 流和 RTP 流所依赖的所有 RTP 流(当存在时)的属性。这与 offer/answer 参数的正常用法不同: 通常，这些参数声明 offerer 或 answerer 能够接收的比特流或 RTP 流的属性。处理 HEVC 时，offerer 假设 answerer 能够接收使用所提供的配置编码的媒体。

  信息说明: 上述参数适用于具有相同配置的声明实体发送的任何 RTP 流以及 RTP 流所依赖的所有 RTP 流(当存在时)。换句话说，上述参数对 RTP 流的适用性取决于源端点。这些值在发送时可能必须应用于另一个载荷类型，而不是绑定到载荷类型，因为它们适用于配置。

- 能力参数 max-lsr、max-lps、max-cpb、max-dpb、max-br、max-tr 和 max-tc **可**用于声明 offerer 或 answerer 的进一步接收能力。当方向属性为 sendonly 时，这些参数**不能**存在。
- 能力参数 max-fps **可**用于声明 offerer 或 answerer 较低的接收能力。当方向属性为 sendonly 时，参数**不能**存在。
- 能力参数 dec-parallel-cap **可**用于声明 offerer 或 answerer 用于接收的额外解码能力。在接收到接收者的这种声明时，发送方**可以**在比特流满足并行性要求的假设下，利用这些能力向接收者发送比特流。基于从 dec-parallel-cap 使用并行工具类型 `w` 选择的能力点发送的比特流**必须**满足 entropy_coding_sync_enabled_flag 等于 1，min_spatial_segmentation_idc 等于或大于该能力点的 dec-parallel-cap.spatial-seg-idc。基于从 dec-parallel-cap 使用并行工具类型 `t` 选择的能力点发送的比特流**必须**满足 entropy_coding_sync_enabled_flag 等于 0，min_spatial_segmentation_idc 等于或大于该能力点的 dec-parallel-cap.spatial-seg-idc。
- 当至少一个 RTP 流的 sprop-max-don-diff 大于 0 时，offerer 必须在交织 HEVC 比特流或 MRST 或 MRMT 传输模式的 offer 中包括解交织缓冲区大小、sprop-depack-buf-bytes 以及sprop-max-don-diff 和 sprop-depack-buf-nalus。为了使 offerer 和 answerer 能够相互告知其在接收 RTP 流时的解包缓冲能力，**建议**双方包括 depack-buf-cap。对于交织的 RTP 流或 MRST 或 MRMT，当接收者的能力未知时，还**建议**考虑提供具有不同缓冲要求的多个载荷类型。
- capability 参数 include-dph **可**用于声明利用解码图像散列 SEI 消息的能力，以及 offerer 或 answerer 接收的任何 HEVC RTP 流中的散列类型。
- sprop-vps、sprop-sps 或 sprop-pps (当存在时)(包括在 SDP 的 `a=fmtp` 行或使用 [RFC5576](https://www.rfc-editor.org/rfc/rfc5576) [第 6.3 节](https://www.rfc-editor.org/rfc/rfc5576#section-6.3)规定的 `fmtp` 源属性传输)用于参数集(分别为 VPS、SPS 或 PPS)的带外传输。
- answerer **可以**对其发送的比特流使用参数集的带外传输或带内传输，而不管 offerer-answerer 的方向上是否使用了带外参数集传输。answer 中包含的参数集独立于 offer 中包含的参数集，因为它们用于解码两个不同的比特流，一个从 answerer 到 offerer，另一个是相反方向。如果某些 RTP 流在 SDP offer/answer 确定之前发送，则**必须**为 SDP offer/answer 之前发送的 RTP 流部分使用带内参数集。
- 以下规则适用于 offerer-to-answerer 方向的参数集传输。
  - offer **可能**包括 sprop-vps、sprop-sps 和/或 sprop-pps。如果 offer 中没有这些参数，则仅使用参数集的带内传输。
  - 如果 offerer-to-answerer 方向使用的级别等于 offer 中的默认级别，则 answerer **必须**准备使用 sprop-vps、sprop-sps 和 sprop-pps 中包含的参数集(包括在 SDP 的 `a=fmtp` 行或使用 `fmtp` 源属性传输)，来解码传入的比特流，例如，在传递 RTP 流中携带的任何 NAL 单元之前，通过将这些参数集 NAL 单元传递给视频解码器。否则，answerer **必须**忽略 sprop-vps、sprop-sps 和 sprop-pps (包括在 SDP 的 `a=fmtp` 行或使用 `fmtp` 源属性传输)，并且 offerer **必须**在带内传输参数集。
  - 在 MRST 或 MRMT 中，answerer **必须**准备为 RTP 流和 RTP 流所依赖的所有 RTP 流(当存在时)使用传输的带外参数集，来解码传入的比特流，例如，在传递 RTP 流中携带的任何 NAL 单元之前，通过将这些参数集 NAL 单元传递给视频解码器。
- 以下规则适用于 answerer-to-offerer 方向的参数集传输。
  - answer **可能**包括 sprop-vps、sprop-sps 和/或 sprop-pps。如果 answer 中没有这些参数，则仅使用参数集的带内传输。
  - offerer **必须**准备好使用 sprop-vps、sprop-sps 和 sprop-pps 中包含的参数集(包括在 SDP 的 `a=fmtp` 行或使用 `fmtp` 源属性传输)，来解码传入的比特流，例如，在传递 RTP 流中携带的任何 NAL 单元之前，通过将这些参数集 NAL 单元传递给视频解码器。
  - 在 MRST 或 MRMT 中，offerer **必须**准备为 RTP 流和 RTP 流所依赖的所有 RTP 流(当存在时)使用传输的带外参数集，来解码传入的比特流，例如，在传递 RTP 流中携带的任何 NAL 单元之前，通过将这些参数集 NAL 单元传递给视频解码器。
- 当使用 [RFC5576](https://www.rfc-editor.org/rfc/rfc5576) [第 6.3 节](https://www.rfc-editor.org/rfc/rfc5576#section-6.3)规定的 `fmtp` 源属性传输 sprop-vps、sprop-sps 和/或 sprop-pps 时，参数接收者**必须**存储 sprop-vps、sprop-sps 和/或 sprop-pps 中包含的参数集，并将其与作为 `fmtp` 源属性一部分给出的源关联。与一个源关联的参数集(作为 `fmtp` 源属性的一部分给出)**必须**只用于解码来自同一源(作为 `fmtp` 源属性的一部分给出)的 RTP 数据包中传输的 NAL 单元。使用此机制时，必须按照 [RFC5576](https://www.rfc-editor.org/rfc/rfc5576) 中的规定执行 SSRC 碰撞检测和解决。

对于通过多播传送的比特流，以下规则适用:

- 媒体格式配置由 profile-space、profile-id、tier-flag、level-id、interop-constraints、profile-compatibility-indicator 和 tx-mode 标识。这些媒体格式配置参数(包括 level-id)**必须**对称使用；也就是说，answerer **必须**保留所有配置参数或完全删除媒体格式(载荷类型)。请注意，这意味着多播中 offer/answer 的 level-id 是不可更改的。
- 为了简化这些配置的处理和匹配，answer 中使用的 RTP 载荷类型编号还应与 offer 相同，如 [RFC3264](https://www.rfc-editor.org/rfc/rfc3264) 所述。answer **不能**包含 offer 中使用的载荷类型编号，除非配置与 offer 中的配置相同。
- 接收到的参数集**必须**与原始源关联，并且**必须**只用于解码来自同一源的传入比特流。
- 只要遵守上述三条规则，其他参数的规则与上述单播相同。

表 1 列出了 offer、answer 和方向属性的各种组合**必须**使用的所有参数的解释。请注意，使用 recv-sub-layer-id 参数的两列仅适用于 answer，而其他列同时适用于 offer 和 answer。

表 1——offer、answer、方向属性各种组合的参数解释，包括和不包括 recv-sub-layer-id。不指示 offer 或 answer 的列适用于两者。

```txt
                                    sendonly --+
      answer: recvonly, recv-sub-layer-id --+  |
        recvonly w/- recv-sub-layer-id --+  |  |
answer: sendrecv, recv-sub-layer-id --+  |  |  |
  sendrecv w/- recv-sub-layer-id --+  |  |  |  |
                                   |  |  |  |  |
profile-space                      C  D  C  D  P
profile-id                         C  D  C  D  P
tier-flag                          C  D  C  D  P
level-id                           D  D  D  D  P
interop-constraints                C  D  C  D  P
profile-compatibility-indicator    C  D  C  D  P
tx-mode                            C  C  C  C  P
max-recv-level-id                  R  R  R  R  -
sprop-max-don-diff                 P  P  -  -  P
sprop-depack-buf-nalus             P  P  -  -  P
sprop-depack-buf-bytes             P  P  -  -  P
depack-buf-cap                     R  R  R  R  -
sprop-segmentation-id              P  P  P  P  P
sprop-spatial-segmentation-idc     P  P  P  P  P
max-br                             R  R  R  R  -
max-cpb                            R  R  R  R  -
max-dpb                            R  R  R  R  -
max-lsr                            R  R  R  R  -
max-lps                            R  R  R  R  -
max-tr                             R  R  R  R  -
max-tc                             R  R  R  R  -
max-fps                            R  R  R  R  -
sprop-vps                          P  P  -  -  P
sprop-sps                          P  P  -  -  P
sprop-pps                          P  P  -  -  P
sprop-sub-layer-id                 P  P  -  -  P
recv-sub-layer-id                  X  -  X  -  -
dec-parallel-cap                   R  R  R  R  -
include-dph                        R  R  R  R  -
```

图例:

C: 发送和接收比特流的配置
D: 可更改配置，与 C 相同，但对于 answer 可能使用不同但一致的值(请参见与这些参数配置、层和级别相关的六个参数的语义一致)
P: 要发送的比特流的属性
R: 接收者能力
O: 操作点选择
X: **不能**存在
-: 不可用，存在时**必须**忽略

通常，用于声明接收者能力的参数是可降级的；例如，它们表示发送者可能行为的上限。因此，发送方**可**设置其编码器选择仅使用这些参数的较低/较小或相等值。

如果 answer 中不包括小于 offer 中 sprop-sub-layer-id 的 recv-sub-layer-id，则声明配置点的参数不可更改，但单播使用的 level-id 参数除外，并且这些参数表示接收者期望使用的值，并且在 answer 中**必须**像在 offer 中一样逐字使用。

当使用配置参数声明发送方的能力时，这些参数表示发送方可以接收比特流的配置。为了实现高互操作性级别，通常建议提供多种备选配置。不可能在一种载荷类型中提供多种配置。因此，当做出多个配置 offer 时，每个 offer 都需要与其关联的自己的 RTP 载荷类型。但是，通过在 offer 中包含 sprop-vps，在 answer 中包含 recv-sub-layer-id，可以在单个载荷类型中使用一种配置提供多个操作点。

接收者**应该**理解所有媒体类型参数，即使它只支持载荷格式能力的一个子集。这确保接收者能够理解何时可以将接收媒体的 offer 降级为 offer 接收者支持的内容。

answerer **可以**通过额外的媒体格式配置来扩展 offer。然而，为了能够使用它们，在大多数情况下，需要 offerer 提供第二个 offer，以提供媒体发送方将使用的比特流属性参数。这也意味着，offerer 必须能够接收此媒体格式配置，而不仅仅是发送它。

#### 7.2.3 声明性会话描述中使用

当以声明式方式通过 RTP 与 SDP 一起提供 HEVC 时，如在实时流协议(RTSP) [C2326](https://www.rfc-editor.org/rfc/rfc2326) 或会话通知协议(SAP) [RFC2974](https://www.rfc-editor.org/rfc/rfc2974) 中，需要考虑以下事项。

- 所有能够同时指示比特流属性和接收者能力的参数仅用于指示比特流属性。例如，在这种情况下，参数profile-tier-level-id 声明了比特流使用的值，而不是接收比特流的能力。因此，**必须**使用以下参数解释:
  - 声明实际配置或比特流属性:
    - profile-space
    - profile-id
    - tier-flag
    - level-id
    - interop-constraints
    - profile-compatibility-indicator
    - tx-mode
    - sprop-vps
    - sprop-sps
    - sprop-pps
    - sprop-max-don-diff
    - sprop-depack-buf-nalus
    - sprop-depack-buf-bytes
    - sprop-segmentation-id
    - sprop-spatial-segmentation-idc
  - 不可用(存在时，**必须**忽略它们):
    - max-lps
    - max-lsr
    - max-cpb
    - max-dpb
    - max-br
    - max-tr
    - max-tc
    - max-fps
    - max-recv-level-id
    - depack-buf-cap
    - sprop-sub-layer-id
    - dec-parallel-cap
    - include-dph
- SDP 接收者需要支持提供的所有参数和参数值；否则，接收者**必须**拒绝(RTSP)或不参与(SAP)会话。会话的创建者需要使用接收应用程序期望支持的值。

#### 7.2.4 参数集考虑

当使用参数集的带外传输时，除非应用程序明确禁止，否则仍然**可以**额外在带内传输参数集，并且这些额外参数集中的一些可能会更新一些带外传输的参数集。参数集更新是指使用相同的参数集 ID 发送相同类型的参数集，但参数集的至少一个其他参数的值不同。

#### 7.2.5 多流模式下的依赖标识

如果使用 MRST 或 MRMT，则适用 [RFC5583](https://www.rfc-editor.org/rfc/rfc5583) 定义的 SDP 中关于标识媒体解码相关性的规则。[RFC4566](https://www.rfc-editor.org/rfc/rfc4566) [第 5.7 节](https://www.rfc-editor.org/rfc/rfc4566#section-5.7)关于多播的“分层或分层编码”规则不适用。这意味着连接数据 `c=` 符号**不应**与多个地址一起使用，即，[RFC4566](https://www.rfc-editor.org/rfc/rfc4566) 中描述的 `c=` 字段的子字段 `<Connection address>` 中的子字段 `<number of addresses>` 不能存在。会话依赖顺序是从包含最低时态子层的 RTP 流到包含最高时态子层的 RTP 流。

## 8 与反馈消息一起使用

以下小节定义了与 HEVC 使用的图像丢失指示(Picture Loss Indication, PLI)、切片丢失指示(Slice Lost Indication, SLI)、参考图像选择指示(Reference Picture Selection Indication, RPSI)和完整帧内请求(Full Intra Request, FIR)反馈消息。PLI、SLI 和 RPSI 消息在 [RFC4585](https://www.rfc-editor.org/rfc/rfc4585) 中定义，FIR 消息在 [RFC5104](https://www.rfc-editor.org/rfc/rfc5104) 中定义。

### 8.1 图像丢失指示(PLI)

如 [RFC4585](https://www.rfc-editor.org/rfc/rfc4585) [第 6.3.1 节](https://www.rfc-editor.org/rfc/rfc4585#section-6.3.1)所述，媒体发送方接收到 PLI 表示“丢失了属于一张或多张图像的未定义数量的编码视频数据”。在不具备比特流设置的任何特定知识(例如带内参数集、非 IDR 解码器刷新点、图像结构等的使用和位置)的情况下，HEVC 发送方对接收到 PLI 的反应**应该**是发送 IDR 图像和相关参数集；可能和足够的冗余一起，以确保正确接收。然而，有时已知关于比特流结构的信息。例如，可以在本文中定义的机制之外建立状态，即参数集仅在带外传输，并且在会话期间保持静态。在这种情况下，接收到 PLI 显然没有必要在带内发送它们。可以基于比特流结构不同方面的先验知识设计其他示例。在所有情况下，**必须**遵守 [RFC4585](https://www.rfc-editor.org/rfc/rfc4585) 的定时和拥塞控制机制。

### 8.2 切片丢失指示(SLI)

[RFC4585](https://www.rfc-editor.org/rfc/rfc4585) 中描述的 SLI 可用于向发送方指示图像的 CTB 光栅扫描顺序中的多个编码树块(CTB)的丢失。在 SLI 的反馈控制指示(Feedback Control Indication, FCI)字段中，**必须**将子字段 “First” 设置为第一个丢失 CTB 的 CTB 地址。请注意，CTB 地址按图像的 CTB 光栅扫描顺序。对于切片分片的第一个 CTB，CTB 地址是 slice_segment_address (当存在时)的值，或者当 first_slice_segment_in_pic_flag 值等于 1 时，CTB 地址为 0；这两个语法元素都位于切分片头部。子字段 “Number” **必须**设置为连续丢失 CTB 的数量，同样是图像的 CTB 光栅扫描顺序。请注意，由于 CTB 光栅扫描顺序中的 “First” 和 “Number” 都是以图像 CTB 光栅扫描顺序计数的，而不是以平铺扫描顺序(这是 CTB 的比特流顺序)，因此可能需要多条 SLI 消息来报告一个平铺的丢失，该平铺覆盖多个 CTB 行，但宽度小于图像。

子字段 “PictureID” **必须**设置为 PicOrderCntVal 值的二进制表示的 6 个最低有效位，如 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中所定义，PicOrderCntVal 是指示丢失 CTB 的图像。请注意，对于 IDR 图像，语法元素 slice_pic_order_cnt_lsb 不存在，但随后推断该值等于 0。

如 [RFC4585](https://www.rfc-editor.org/rfc/rfc4585) 中所述，媒体发送者中的编码器可以使用该信息通过发送帧内信息来“清理”损坏的图像，同时遵守 [RFC4585](https://www.rfc-editor.org/rfc/rfc4585) 所述约束，例如，关于拥塞控制。在许多情况下，由于通过运动补偿将错误导入图像的未损坏区域，因此需要错误跟踪来识别接收者状态中的损坏区域(参考图像)。参考图像选择还可用于“清理”损坏的图像，这通常比发送帧内信息更有效，也不太可能产生拥塞。

与 [RFC4585](https://www.rfc-editor.org/rfc/rfc4585) 和 [RFC5104](https://www.rfc-editor.org/rfc/rfc5104) 中设想的视频编解码器相反，在 HEVC 中，“宏块大小”不是固定为 16x16 luma 采样，而是可变的。然而，这不会给 SLI 带来概念上的困难，因为 CTB 大小的设置是序列级功能，跨 CVS 边界使用切片丢失指示是没有意义的，因为跨序列边界没有预测。然而，SLI 消息的正确使用并不像具有旧的、固定宏块大小的视频编解码器那样简单，因为在解释 FCI 中的 “First” 子字段时，必须考虑序列参数集的状态(CTB 大小所在的位置)。

### 8.3 参考图像选择指示(RPSI)

基于反馈的参考图像选择已被证明是一种强大的工具，可以阻止时间错误传播，从而提高错误恢复能力 [Girod99](https://www.rfc-editor.org/rfc/rfc7798#ref-Girod99) [Wang05](https://www.rfc-editor.org/rfc/rfc7798#ref-Wang05)。在一种方法中，解码器侧跟踪解码图像中的错误，并通知编码器侧相对较早正确解码的特定图像仍然存在解码图像缓冲区中；它要求编码器在编码下一张图像时，使用其正确的图像可用性信息，从而停止进一步的时间错误传播。对于这种方法，解码器端应该使用 RPSI 反馈消息。

编码器**可以**按照 H.264 或 HEVC 中的规定对一些长期参考图像进行编码，以达到上一段所述目的，而不需要庞大的解码图像缓冲区。如 [Wang05](https://www.rfc-editor.org/rfc/rfc7798#ref-Wang05) 所示，使用灵活的参考图像管理方案，如 H.264 和 HEVC 所示，即使解码图像缓冲区大小是两个图像存储缓冲区的也适用于上一段描述的方法。

对于 RPSI 反馈消息指示的图像，字段“每个编解码器定义的原生 RPSI 比特字符串”是 8 位的 base16 [RFC4648](https://www.rfc-editor.org/rfc/rfc4648) 表示，8 位包括 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中定义等于 0 的 2 个最高有效位和 nuh_layer_id 的 6 位，然后是 [HEVC](https://www.rfc-editor.org/rfc/rfc7798#ref-HEVC) 中定义的PicOrderCntVal 值(以网络字节顺序)的 32 位表示。

不推荐使用 RPSI 反馈消息作为 HEVC 的肯定确认。换句话说，RPSI 反馈消息**必须**仅用作参考图像选择请求，以便它也可以在多播中使用。

### 8.4 完整帧内请求(FIR)

FIR 消息的目的是迫使编码器尽快发送独立的解码器刷新点(例如，遵守 [RFC5104](https://www.rfc-editor.org/rfc/rfc5104) 中设置的拥塞控制相关约束)。

收到FIR后，发送方**必须**发送 IDR 图像。还**必须**发送参数集，除非事先知道参数集已正确建立。典型的例子是发送方和接收者之间通过本文以外的方式达成的理解，即参数集仅在带外发送。

## 9 安全考虑
  
本安全注意事项部分的范围仅限于载荷格式本身和 HEVC 的一个功能，如果简单实现该功能，可能会带来特别严重的安全风险。载荷格式是孤立的，不构成一个完整的系统。建议实现者阅读并理解相关的安全文档，尤其是与 RTP 相关的文档(参见 [RFC3550](https://www.rfc-editor.org/rfc/rfc3550) 中的安全注意事项部分)，以及所选调用控制堆栈的安全性(可利用本文的媒体类型注册)。实现者还应该考虑一般的视频编码和解码实现的已知安全漏洞，并避免这些漏洞。

在本 RTP 载荷格式中，除了下面描述的用户数据 SEI 消息之外，除了 RTP 载荷格式常见的安全威胁之外，没有已知的安全威胁。换句话说，无论是基于媒体平面的各种机制，还是本文的标识部分，似乎都不会带来超出所有基于 RTP 的系统所共有的安全风险。

使用本规范定义的载荷格式的 RTP 数据包受 RTP 规范 [RFC3550](https://www.rfc-editor.org/rfc/rfc3550) 和任何适用 RTP 配置文件(如 RTP/AVP [RFC3551](https://www.rfc-editor.org/rfc/rfc3551)、RTP/AVPF [RFC4585](https://www.rfc-editor.org/rfc/rfc4585)、RTP/SAVP [RFC3711](https://www.rfc-editor.org/rfc/rfc3711) 或 RTP/SAVPF [RFC5124](https://www.rfc-editor.org/rfc/rfc5124) 中讨论的安全注意事项的约束。然而，正如 [RFC7202](https://www.rfc-editor.org/rfc/rfc7202) 所讨论的 “保护 RTP 框架: 为什么 RTP 不强制要求单一媒体安全解决方案”，RTP 载荷格式不负责讨论或强制要求使用什么解决方案来满足 RTP 的基本安全目标，如机密性、完整性和源真实性。这一责任由在应用程序中使用 RTP 的任何人承担。他们可以在 [C7201](https://www.rfc-editor.org/rfc/rfc7201) “保护 RTP 会话的选项”中找到关于可用安全机制和重要注意事项的指导。应用程序**应**使用一个或多个适当的强安全机制。本节的其余部分将讨论影响载荷格式本身属性的安全性。

由于与此载荷格式一起使用的数据压缩是端到端应用的，因此任何加密都需要在压缩后执行。使用压缩技术的数据编码存在潜在的拒绝服务威胁，这种压缩技术具有非均匀的接收端计算负载。攻击者可以向比特流中注入病理数据报，这些数据报解码复杂，导致接收者过载。H.265 特别容易受到这种攻击，因为非常简单就可以生成包含 NAL 单元的数据报，该 NAL 单元影响未来许多 NAL 单元的解码过程。因此，建议至少使用 RTP 包的数据源认证和数据完整性保护，例如，使用 SRTP [RFC3711](https://www.rfc-editor.org/rfc/rfc3711)。

与 [H.264](https://www.rfc-editor.org/rfc/rfc7798#ref-H.264) 类似，HEVC 包括用户数据补充增强信息(SEI)消息。此 SEI 消息允许将任意位字符串包含到视频比特流中。这样的位字符串可以包括 JavaScript、机器代码和其他活动内容。HEVC 将此 SEI 消息的处理留给接收系统。为了避免用户数据 SEI 消息的有害副作用，解码器实现不能天真地信任其内容。例如，将解码器实现检测到的任何 JavaScript 转发到 web 浏览器将是一种糟糕且不安全的实现做法。处理用户数据 SEI 消息最安全的方法是简单地丢弃它们，但这可能会对用户的体验质量产生负面影响。

具有身份验证、完整性或机密性保护的端到端安全性将防止 MANE 执行除丢弃完整数据包以外的媒体感知操作。在机密性保护的情况下，甚至可以防止它以媒体感知的方式丢弃数据包。要允许执行此类操作，MANE 必须是受信任实体，包含在安全性上下文建立中。

## 10 拥塞控制

RTP 的拥塞控制应根据 RTP [RFC3550](https://www.rfc-editor.org/rfc/rfc3550) 和任何适用的 RTP 配置文件(如 AVP [RFC3551](https://www.rfc-editor.org/rfc/rfc3551))使用。如果正在使用尽力而为的服务，另一个要求是，此载荷格式的用户**必须**监控数据包丢失，以确保数据包丢失率在可接受的范围内。如果 TCP 流通过相同网络路径并经历相同网络条件，在合理时间尺度上测量将达到平均吞吐量，即不小于所有 RTP 流组合所达到的平均吞吐量，则认为丢包是可接受的。通过实现拥塞控制机制以适应传输速率、为分层多播会话订阅的层数，或者如果丢失率高得令人无法接受，则通过安排接收者离开会话，可以满足该条件。

当使用实时编码时，例如通过适当地调整量化参数，遵守拥塞控制原则所需的比特率自适应可以容易实现。

然而，当传输预编码内容时，带宽自适应要求针对这种自适应性定制预编码比特流。HEVC 中可用的关键机制是时间可伸缩性。媒体发送者可以移除属于更高时间子层的 NAL 单元(即，那些具有高 TID 值的 NAL 单元)，直到发送比特率下降到可接受的范围。HEVC 包含机制允许在时间增强层中轻量级识别切换点，如本文[第 1.1.2 节](#112-系统和传输接口)所述。HEVC 媒体发送者可以从这些交换点开始发送属于时间增强层 NAL 单元的数据包，以探测可用带宽和利用已显示可用的带宽。

上述机制通常在定义的配置和级别内适用，因此，不需要重新协商通道。只有需要更改不可降级的参数(如配置)时，才有必要终止和重新启动 RTP 流。这可以通过使用不同的 RTP 载荷类型来实现。

当 RTP 流由于先前的数据包丢失而损坏时，MANE **可以**从 RTP 流中移除某些不可用的数据包。在某些特殊情况下，这有助于减少网络负载。例如，MANE 可以删除属于同一 NAL 单元的前导 FU 已丢失的 FU，或者删除属于同一切片的前导分片已丢失的从属切片分片，因为之后的 FU 或从属切片分片对大多数解码器来说是无意义的。如果出站传输(outbound transmission)(从 MANE 的角度来看)遇到拥塞，MANE 还可以移除更高的时间可伸缩层。

## 11 IANA 考虑

本文 [7.1 节](#71-媒体类型注册)规定的新媒体类型已在 IANA 注册。

## 12 参考

### 12.1 规范性引用

[H.264] ITU-T, "Advanced video coding for generic audiovisual services", ITU-T Recommendation H.264, April 2013.

[HEVC]  ITU-T, "High efficiency video coding", ITU-T Recommendation H.265, April 2013.

[ISO23008-2] ISO/IEC, "Information technology -- High efficiency coding and media delivery in heterogeneous environments -- Part 2: High efficiency video coding", ISO/IEC 23008-2, 2013.

[RFC2119] Bradner, S., "Key words for use in RFCs to Indicate Requirement Levels", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997, <http://www.rfc-editor.org/info/rfc2119>.

[RFC3264]  Rosenberg, J. and H. Schulzrinne, "An Offer/Answer Model with Session Description Protocol (SDP)", RFC 3264, DOI 10.17487/RFC3264, June 2002, <http://www.rfc-editor.org/info/rfc3264>.

[RFC3550]  Schulzrinne, H., Casner, S., Frederick, R., and V. Jacobson, "RTP: A Transport Protocol for Real-Time Applications", STD 64, RFC 3550, DOI 10.17487/RFC3550, July 2003, <http://www.rfc-editor.org/info/rfc3550>.

[RFC3551] Schulzrinne, H. and S. Casner, "RTP Profile for Audio and Video Conferences with Minimal Control", STD 65, RFC 3551, DOI 10.17487/RFC3551, July 2003, <http://www.rfc-editor.org/info/rfc3551>.

[RFC3711] Baugher, M., McGrew, D., Naslund, M., Carrara, E., and K. Norrman, "The Secure Real-time Transport Protocol (SRTP)", RFC 3711, DOI 10.17487/RFC3711, March 2004, <http://www.rfc-editor.org/info/rfc3711>.

[RFC4566] Handley, M., Jacobson, V., and C. Perkins, "SDP: Session Description Protocol", RFC 4566, DOI 10.17487/RFC4566, July 2006, <http://www.rfc-editor.org/info/rfc4566>.

[RFC4585]  Ott, J., Wenger, S., Sato, N., Burmeister, C., and J. Rey, "Extended RTP Profile for Real-time Transport Control Protocol (RTCP)-Based Feedback (RTP/AVPF)", RFC 4585, DOI 10.17487/RFC4585, July 2006, <http://www.rfc-editor.org/info/rfc4585>.

[RFC4648] Josefsson, S., "The Base16, Base32, and Base64 Data Encodings", RFC 4648, DOI 10.17487/RFC4648, October 2006, <http://www.rfc-editor.org/info/rfc4648>.

[RFC5104]  Wenger, S., Chandra, U., Westerlund, M., and B. Burman, "Codec Control Messages in the RTP Audio-Visual Profile with Feedback (AVPF)", RFC 5104, DOI 10.17487/RFC5104, February 2008, <http://www.rfc-editor.org/info/rfc5104>.

[RFC5124] Ott, J. and E. Carrara, "Extended Secure RTP Profile for Real-time Transport Control Protocol (RTCP)-Based Feedback (RTP/SAVPF)", RFC 5124, DOI 10.17487/RFC5124, February 2008, <http://www.rfc-editor.org/info/rfc5124>.

[RFC5234] Crocker, D., Ed., and P. Overell, "Augmented BNF for Syntax Specifications: ABNF", STD 68, RFC 5234, DOI 10.17487/RFC5234, January 2008, <http://www.rfc-editor.org/info/rfc5234>.

[RFC5576]  Lennox, J., Ott, J., and T. Schierl, "Source-Specific Media Attributes in the Session Description Protocol (SDP)", RFC 5576, DOI 10.17487/RFC5576, June 2009, <http://www.rfc-editor.org/info/rfc5576>.

[RFC5583]  Schierl, T. and S. Wenger, "Signaling Media Decoding Dependency in the Session Description Protocol (SDP)", RFC 5583, DOI 10.17487/RFC5583, July 2009, <http://www.rfc-editor.org/info/rfc5583>.

### 12.2 资料性引用

[3GPDASH] 3GPP, "Transparent end-to-end Packet-switched Streaming Service (PSS); Progressive Download and Dynamic Adaptive Streaming over HTTP (3GP-DASH)", 3GPP TS 26.247 12.1.0, December 2013.

[3GPPFF] 3GPP, "Transparent end-to-end packet switched streaming service (PSS); 3GPP file format (3GP)", 3GPP TS 26.244 12.20, December 2013.

[CABAC] Sole, J., Joshi, R., Nguyen, N., Ji, T., Karczewicz, M., Clare, G., Henry, F., and Duenas, A., "Transform coefficient coding in HEVC", IEEE Transactions on Circuts and Systems for Video Technology, Vol. 22, No. 12, pp. 1765-1777, DOI 10.1109/TCSVT.2012.2223055, December 2012.

[Girod99] Girod, B. and Faerber, F., "Feedback-based error control for mobile video transmission", Proceedings of the IEEE, Vol. 87, No. 10, pp. 1707-1723, DOI 10.1109/5.790632, October 1999.

[H.265.1] ITU-T, "Conformance specification for ITU-T H.265 high efficiency video coding", ITU-T Recommendation H.265.1, October 2014.

[MPEG] Flynn, D., Naccari, M., Rosewarne, C., Sharman, K., Sole, J., Sullivan, G. J., and T. Suzuki, "High Efficiency Video Coding (HEVC) Range Extensions text specification: Draft 7", JCT-VC document JCTVC-Q1005, 17th JCT-VC meeting, Valencia, Spain, March/April 2014.

[MPEG14496-12] IS0/IEC, "Information technology - Coding of audio-visual objects - Part 12: ISO base media file format", IS0/IEC 14496-12, 2015.

[MPEG15444-12] IS0/IEC, "Information technology - JPEG 2000 image coding system - Part 12: ISO base media file format", IS0/IEC 15444-12, 2015.

[JCTVC-J0107] Wang, Y.-K., Chen, Y., Joshi, R., and Ramasubramonian, K., "AHG9: On RAP pictures", JCT-VC document JCTVC-L0107, 10th JCT-VC meeting, Stockholm, Sweden, July 2012.

[MPEG2S] ISO/IEC, "Information technology - Generic coding of moving pictures and associated audio information - Part 1: Systems", ISO International Standard 13818-1, 2013.

[MPEGDASH] ISO/IEC, "Information technology - Dynamic adaptive streaming over HTTP (DASH) -- Part 1: Media presentation description and segment formats", ISO International Standard 23009-1, 2012.

[RFC2326] Schulzrinne, H., Rao, A., and R. Lanphier, "Real Time Streaming Protocol (RTSP)", RFC 2326, DOI 10.17487/RFC2326, April 1998, <http://www.rfc-editor.org/info/rfc2326>.

[RFC2974] Handley, M., Perkins, C., and E. Whelan, "Session Announcement Protocol", RFC 2974, DOI 10.17487/RFC2974, October 2000, <http://www.rfc-editor.org/info/rfc2974>.

[RFC6051] Perkins, C. and T. Schierl, "Rapid Synchronisation of RTP Flows", RFC 6051, DOI 10.17487/RFC6051, November 2010, <http://www.rfc-editor.org/info/rfc6051>.

[RFC6184] Wang, Y.-K., Even, R., Kristensen, T., and R. Jesup, "RTP Payload Format for H.264 Video", RFC 6184, DOI 10.17487/RFC6184, May 2011, <http://www.rfc-editor.org/info/rfc6184>.

[RFC6190] Wenger, S., Wang, Y.-K., Schierl, T., and A. Eleftheriadis, "RTP Payload Format for Scalable Video Coding", RFC 6190, DOI 10.17487/RFC6190, May 2011, <http://www.rfc-editor.org/info/rfc6190>.

[RFC7201] Westerlund, M. and C. Perkins, "Options for Securing RTP Sessions", RFC 7201, DOI 10.17487/RFC7201, April 2014, <http://www.rfc-editor.org/info/rfc7201>.

[RFC7202] Perkins, C. and M. Westerlund, "Securing the RTP Framework: Why RTP Does Not Mandate a Single Media Security Solution", RFC 7202, DOI 10.17487/RFC7202, April 2014, <http://www.rfc-editor.org/info/rfc7202>.

[RFC7656]  Lennox, J., Gross, K., Nandakumar, S., Salgueiro, G., and B. Burman, Ed., "A Taxonomy of Semantics and Mechanisms for Real-Time Transport Protocol (RTP) Sources", RFC 7656, DOI 10.17487/RFC7656, November 2015, <http://www.rfc-editor.org/info/rfc7656>.

[RFC7667]  Westerlund, M. and S. Wenger, "RTP Topologies", RFC 7667, DOI 10.17487/RFC7667, November 2015, <http://www.rfc-editor.org/info/rfc7667>.

[RTP-MULTI-STREAM]  Lennox, J., Westerlund, M., Wu, Q., and C. Perkins, "Sending Multiple Media Streams in a Single RTP Session", Work in Progress, draft-ietf-avtcore-rtp-multi-stream-11, December 2015.

[SDP-NEG]  Holmberg, C., Alvestrand, H., and C. Jennings, "Negotiating Medai Multiplexing Using Session Description Protocol (SDP)", Work in Progress, draft-ietf-mmusic-sdp-bundle-negotiation-25, January 2016.

[Wang05] Wang, Y.-K., Zhu, C., and Li, H., "Error resilient video coding using flexible reference fames", Visual Communications and Image Processing 2005 (VCIP 2005), Beijing, China, July 2005.

## 致谢

感谢 Muhammed Coban 和 Marta Karczewicz 就本文中的反馈信息和其他方面的使用规范进行讨论。感谢 Jonathan Lennox 和 Jill Boyce 为本文中的 PACI 设计所做的贡献。感谢 Rickard Sjoberg、Arild Fuldseth、Bo Burman、Magnus Westerlund 和 Tom Kristensen 为并行处理相关的标识做出的贡献。Magnus Westerlund、Jonathan Lennox、Bernard Aboba、Jonatan Samuelsson、Roni Een、Rickard Sjoberg、Sachin Deshpande、Woo Johnman、Mo Zanaty、Ross Finlayson、Danny Hong、Bo Burman、Ben Campbell、Brian Carpenter、Qin Wu、Stephen Farrell 和 Min Wang 发表了宝贵的评论，这些评论带来了改进。

## 作者地址

Ye-Kui Wang Qualcomm Incorporated 5775 Morehouse Drive San Diego, CA 92121 United States Phone: +1-858-651-8345 Email: yekui.wang@gmail.com

Yag- Sanchez Fraunhofer HHI Einsteinufer 37 D-10587 Berlin Germany Phone: +49 30 31002-663 Email: yago.sanchez@hhi.fraunhofer.de

Thomas Schierl Fraunhofer HHI Einsteinufer 37 D-10587 Berlin Germany Phone: +49-30-31002-227 Email: thomas.schierl@hhi.fraunhofer.de

Stephan Wenger Vidyo, Inc. 433 Hackensack Ave., 7th floor Hackensack, NJ 07601 United States Phone: +1-415-713-5473 Email: stewe@stewe.org

Miska M. Hannuksela Nokia Corporation P.O. Box 1000 33721 Tampere Finland Phone: +358-7180-08000 Email: miska.hannuksela@nokia.com
