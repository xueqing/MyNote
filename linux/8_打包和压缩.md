# 8 打包(归档)和压缩

- [8 打包(归档)和压缩](#8-%E6%89%93%E5%8C%85%E5%BD%92%E6%A1%A3%E5%92%8C%E5%8E%8B%E7%BC%A9)
  - [概念](#%E6%A6%82%E5%BF%B5)
  - [命令](#%E5%91%BD%E4%BB%A4)
    - [tar](#tar)
      - [tar 命令做打包操作](#tar-%E5%91%BD%E4%BB%A4%E5%81%9A%E6%89%93%E5%8C%85%E6%93%8D%E4%BD%9C)
      - [tar 命令做解打包操作](#tar-%E5%91%BD%E4%BB%A4%E5%81%9A%E8%A7%A3%E6%89%93%E5%8C%85%E6%93%8D%E4%BD%9C)
      - [tar 命令做打包压缩(解压缩解打包)操作](#tar-%E5%91%BD%E4%BB%A4%E5%81%9A%E6%89%93%E5%8C%85%E5%8E%8B%E7%BC%A9%E8%A7%A3%E5%8E%8B%E7%BC%A9%E8%A7%A3%E6%89%93%E5%8C%85%E6%93%8D%E4%BD%9C)
    - [zip](#zip)
    - [unzip](#unzip)
    - [gzip](#gzip)
    - [gunzip](#gunzip)
    - [bzip2](#bzip2)
    - [bunzip2](#bunzip2)

## 概念

- 打包：也称为归档，指的是一个文件或目录的集合，而这个集合被存储在一个文件中。归档文件没有经过压缩，因此，它占用的空间是其中所有文件和目录的总和
- 压缩：指利用算法将文件进行处理，已达到保留最大文件信息，而让文件体积变小的目的。基本原理为，通过查找文件内的重复字节，建立一个相同字节的词典文件，并用一个代码表示
  - 有损压缩：指即便丢失个别的数据，对文件也不会造成太大的影响。广泛应用于动画、声音和图像文件中，典型代表就是影碟文件格式 mpeg、音乐文件格式 mp3 以及图像文件格式 jpg
  - 无损压缩：指压缩数据必须准确无误
- 压缩包：采用压缩工具对文件进行压缩，生成的文件。该文件的体积通常只有原文件的一半甚至更小
- 解压：压缩包中的数据无法直接使用，使用前需要利用压缩工具将文件数据还原的过程称为解压缩

## 命令

- 常用的归档命令：tar 和 dd(相对而言，tar 的使用更为广泛)
- 常用的压缩命令：如 tar、gzip、zip、bzip2 等

### tar

- tar 可以将许多文件一起保存到一个单独的磁带或磁盘中进行归档。使用 tar 命令归档的包通常称为 tar 包(tar 包文件都是以 `.tar` 结尾)
- tar 还可以从归档文件中还原所需文件，也就是打包的反过程，称为解打包

#### tar 命令做打包操作

- 语法 `tar [选项] 源文件或目录`
- 选项与参数
  - -c：将多个文件或目录进行打包
  - -A：追加 tar 文件到归档文件
  - -f 包名：指定包的文件名。包的扩展名是用来给管理员识别格式的，所以一定要正确指定扩展名
  - -v：显示打包文件过程
- 在使用 tar 命令指定选项时可以不在选项前面输入 "-"
- 选项 "-cvf" 一般是习惯用法，记住打包时需要指定打包之后的文件名，而且要用 ".tar" 作为扩展名
- 打包并压缩目录。**压缩命令不能直接压缩目录**，必须先用 tar 命令将目录打包，然后才能用 gzip 命令或 bzip2 命令对打包文件进行压缩

#### tar 命令做解打包操作

- 语法 `tar [选项] 压缩包`
- 选项与参数
  - -x：对 tar 包做解打包操作
  - -f 包名：指定要解压的 tar 包的包名
  - -t：只查看 tar 包中有哪些文件或目录，不对 tar 包做解打包操作
  - -C 目录：指定解打包位置
  - -v：显示解打包的具体过程
- 习惯使用 "-xvf" 选项，会把包中的文件解压到当前目录下。如果想要指定解压位置，则需要使用 "-C(大写)" 选项
- 只想查看文件包中有哪些文件，则可以把解打包选项 "-x" 更换为测试选项 "-t"

#### tar 命令做打包压缩(解压缩解打包)操作

- 语法 `tar [选项] 压缩包 源文件或目录`
- 选项与参数
  - -z：压缩和解压缩 ".tar.gz" 格式，习惯使用 "-zcvf" 和 "-zxvf"
  - -j：压缩和解压缩 ".tar.bz2"格式，习惯使用 "-jcvf" 和 "-jxvf"

### zip

- ".zip" 格式文件是 Windows 和 Linux 系统都通用的压缩文件类型，属于几种主流的压缩格式(zip、rar等)之一，是一种相当简单的分别压缩每个文件的存储格式
- 语法 `zip [选项] 压缩包名 源文件或源目录列表`
  - **zip 压缩命令需要手工指定压缩之后的压缩包名，注意写清楚扩展名，以便解压缩时使用**
- 选项与参数
  - -r：递归压缩目录，及将制定目录下的所有文件以及子目录全部压缩
  - -m：将文件压缩之后，删除原始文件，相当于把文件移到压缩文件中
  - -v：显示详细的压缩过程信息
  - -q：在压缩的时候不显示命令的执行过程
  - -压缩级别：压缩级别是从 1~9 的数字，-1 代表压缩速度更快，-9 代表压缩效果更好
  - -u：更新压缩文件，即往压缩文件中添加新文件

### unzip

- unzip 命令可以查看和解压缩 zip 文件
- 语法 `unzip [选项] 压缩包名`
- 选项与参数
  - -d 目录名：将压缩文件解压到指定目录下
  - -n：解压时并不覆盖已经存在的文件
  - -o：解压时覆盖已经存在的文件，并且无需用户确认
  - -v：查看压缩文件的详细信息，包括压缩文件中包含的文件大小、文件名以及压缩比等，但并不做解压操作
  - -t：测试压缩文件有无损坏，但并不解压
  - -x 文件列表：解压文件，但不包含文件列表中指定的文件

### gzip

- gzip 是 Linux 系统中经常用来对文件进行压缩和解压缩的命令，通过此命令压缩得到的新文件，其扩展名通常标记为 “.gz”
- **gzip 命令只能用来压缩文件，不能压缩目录，即便指定了目录，也只能压缩目录内的所有文件，即对目录内每个文件执行 gzip 命令**
- 语法 `gzip [选项] 源文件`
  - 命令中的源文件，当进行压缩操作时，指的是普通文件；当进行解压缩操作时，指的是压缩文件
  - 不带参数时，默认将源文件压缩，生成压缩文件，不会保留源文件
- 选项与参数
  - -c：将压缩数据输出到标准输出中，并保留源文件
  - -d：对压缩文件进行解压缩
  - -r：递归压缩指定目录下以及子目录下的所有文件
  - -v：对于每个压缩和解压缩的文件，显示相应的文件名和压缩比
  - -l：对每一个压缩文件，显示以下字段：压缩文件的大小；未压缩文件的大小；压缩比；未压缩文件的名称
  - -数字：用于指定压缩等级，-1 压缩等级最低，压缩比最差；-9 压缩比最高。默认压缩比是 -6

```sh
# 保留源文件压缩
[root@localhost ~]# gzip -c anaconda-ks.cfg >anaconda-ks.cfg.gz
# 使用-c，但是不让压缩数据输出到屏幕上，而是重定向到压缩文件，这样可以压缩文件的同时不删除源文件
[root@localhost ~]# ls
anaconda-ks.cfg anaconda-ks.cfg.gz install.log.gz install.log.syslog
```

### gunzip

- 用于解压被 gzip 压缩过的文件(扩展名为 “.gz”)
- 对于解压被 gzip 压缩过的文件，还可以使用 gzip 命令，即 `gzip -d` 压缩包
- 语法 `gunzip [选项] 文件`
- 选项与参数
  - -r 目录名：递归处理，解压缩指定目录下以及子目录下的所有文件
  - -c：把解压缩后的文件输出到标准输出设备
  - -f：强制解压缩文件，不理会文件是否已存在等情况
  - -l：列出压缩文件内容
  - -v：显示命令执行过程
  - -t：测试压缩文件是否正常，但不对其做解压缩操作
- 如果压缩的是一个纯文本文件，则可以直接使用 `zcat` 命令在不解压缩的情况下查看这个文本文件中的内容

### bzip2

- 同 gzip 命令类似，只能对文件进行压缩(或解压缩)，对于目录只能压缩(或解压缩)该目录及子目录下的所有文件。当执行压缩任务完成后，会生成一个以 “.bz2” 为后缀的压缩包
- 从理论上来讲，".bz2"格式的算法更先进、压缩比更好；而 ".gz"格式相对来讲的时间更快
- 语法 `bzip2 [选项] 源文件`
  - 源文件指的要压缩或解压缩的文件
- 选项与参数
  - -d：执行解压缩，此时该选项后的源文件应为标记有 .bz2 后缀的压缩包文件
  - -k：bzip2 在压缩或解压缩任务完成后，会删除原始文件，若要保留原始文件，可使用此选项
  - -f：bzip2 在压缩或解压缩时，若输出文件与现有文件同名，默认不会覆盖现有文件，若使用此选项，则会强制覆盖现有文件
  - -t：测试压缩包文件的完整性
  - -v：压缩或解压缩文件时，显示详细信息
  - -数字：这个参数和 gzip 命令的作用一样，用于指定压缩等级，-1 压缩等级最低，压缩比最差；-9 压缩比最高
- gzip 只是不会打包目录，但是如果使用“-r”选项，则可以分别压缩目录下的每个文件；而 bzip2 命令则根本不支持压缩目录，也没有“-r”选项

### bunzip2

- 要解压“.bz2”格式的压缩包文件，除了使用“bzip2 -d 压缩包名”命令外，还可以使用 bunzip2
- bunzip2 命令只能用于解压文件，即便解压目录，也是解压该目录以及所含子目录下的所有文件
- 语法 `bunzip2 [选项] 源文件`
- 选项与参数
  - -k：解压缩后，默认会删除原来的压缩文件。若要保留压缩文件，需使用此参数
  - -f：解压缩时，若输出的文件与现有文件同名时，默认不会覆盖现有的文件。若要覆盖，可使用此选项
  - -v：显示命令执行过程
  - -L：列出压缩文件内容
- ".bz2" 格式压缩的纯文本文件也可以不解压缩直接查看，使用的命令是 `bzcat`
